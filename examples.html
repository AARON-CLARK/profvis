<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Examples</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/htmlwidgets-0.6/htmlwidgets.js"></script>
<script src="site_libs/d3-3.5.6/d3.min.js"></script>
<link href="site_libs/profvis-0.2.8/profvis.css" rel="stylesheet" />
<script src="site_libs/profvis-0.2.8/profvis.js"></script>
<link href="site_libs/highlight-6.2.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlight-6.2.0/highlight.js"></script>
<script src="site_libs/profvis-binding-0.2.8/profvis.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<link rel="stylesheet"
      href="site_libs/highlight/textmate.css"
      type="text/css" />
<script src="site_libs/highlight/highlight.js"></script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>

<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Profvis</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Introduction</a>
</li>
<li>
  <a href="examples.html">Examples</a>
</li>
<li>
  <a href="faq.html">FAQ</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/rstudio/profvis/">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Examples</h1>

</div>

<div id="TOC">
<ul>
<li><a href="#example-1">Example 1</a></li>
<li><a href="#example-2">Example 2</a></li>
</ul>
</div>

<p>Below are some examples of profvis in use. Keep in mind that R’s sampling profiler is non-deterministic, and that the code in these examples is run and profiled when this knitr document is executed, so the numeric timing values may not exactly match the text.</p>
<div id="example-1" class="section level3">
<h3>Example 1</h3>
<p>In this first example, we’ll work with a data frame that has 151 columns. One of the columns contains an ID, and the other 150 columns contain numeric values. What we will do is, for each numeric column, take the mean and subtract it from the column, so that the new mean value of the column is zero.</p>
<pre class="r"><code># Generate data
times &lt;- 4e5
cols &lt;- 150
data &lt;- as.data.frame(x = matrix(rnorm(times * cols, mean = 5), ncol = cols))
data &lt;- cbind(id = paste0(&quot;g&quot;, seq_len(times)), data)

profvis({
  data1 &lt;- data   # Store in another variable for this run

  # Get column means
  means &lt;- apply(data1[, names(data1) != &quot;id&quot;], 2, mean)

  # Subtract mean from each column
  for (i in seq_along(means)) {
    data1[, names(data1) != &quot;id&quot;][, i] &lt;- data1[, names(data1) != &quot;id&quot;][, i] - means[i]
  }
})</code></pre>
<div id="htmlwidget-5029" style="width:100%;height:450px;" class="profvis html-widget"></div>
<script type="application/json" data-for="htmlwidget-5029">{"x":{"message":{"prof":{"time":[1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,6,6,6,6,7,7,7,7,8,8,8,8,9,9,9,9,10,10,10,10,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,14,15,15,15,15,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,22,22,22,22,23,23,23,23,24,24,24,24,25,25,25,25,26,26,26,27,27,27,28,28,28,29,29,29,30,30,30,31,31,31,32,32,32,33,33,33,34,34,34,35,35,35,36,36,36,37,37,37,38,38,38,39,39,39,40,40,40,41,41,41,42,42,42,43,43,43,44,44,44,45,45,45,46,46,46,47,47,47,48,48,48,49,49,49,50,51,52,53,54,55,56,57,58,59,60,61,61,61,62,63,64,65,65,65,66,67,68,68,69,70,71,71,71,72,73,73,73,74,75,75,75,76,77,77,77,78,79,79,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,93,94,94,95,95,96,96,97,97,98,98,99,100,101,102,103,103,103,104,105,105,105,106,107,107,107,108,109,109,109,110,111,112,113,113,113,114,114,114,114,115,115,116,117,117,117,118,118,119,120,120,120,120,121,121,122,122,123,124,124,124,124,125,126,126,126,126,126,127,128,128,128,128,128,128,129,130,130,130,130,131,131,131,132,132,132,132,132,132,133,133,133,133,134,134,135,135,135,135,136,137,137,137,137,137,137,138,139,139,139,139,139,140,140,141,141,141,141,141,142,142,142,142,143,143,144,144,144,144,144,145,145,146,146,146,146,147,147,148,148,148,149,149,149,149,150,150,150,150,151,152,152,153,153,154,154,154,154,154,155,155,156,156,157,158,158,158,158,159,160,160,160,160,160,161,161,161,161,161,162,162,162,162,162,163,163,163,163,163,164,164,164,164,164,165,165,165,165,165,166,166,166,167,167,167,167,168,169,169,169,169,170,170,171,171,171,171,172,172,172,172,172,173,174,174,175,175,175,175,175,175,175,176,176,176,176,176,177,177,178,178,179],"depth":[4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,1,1,1,1,1,1,1,1,1,1,1,3,2,1,1,1,1,3,2,1,1,1,2,1,1,1,3,2,1,1,3,2,1,1,3,2,1,1,3,2,1,1,3,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,1,2,1,2,1,2,1,2,1,2,1,1,1,1,1,3,2,1,1,3,2,1,1,3,2,1,1,3,2,1,1,1,1,3,2,1,4,3,2,1,2,1,1,3,2,1,2,1,1,4,3,2,1,2,1,2,1,1,4,3,2,1,1,5,4,3,2,1,1,6,5,4,3,2,1,1,4,3,2,1,3,2,1,6,5,4,3,2,1,4,3,2,1,2,1,4,3,2,1,1,6,5,4,3,2,1,1,5,4,3,2,1,2,1,5,4,3,2,1,4,3,2,1,2,1,5,4,3,2,1,2,1,4,3,2,1,2,1,3,2,1,4,3,2,1,4,3,2,1,1,2,1,2,1,5,4,3,2,1,2,1,2,1,1,4,3,2,1,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,3,2,1,4,3,2,1,1,4,3,2,1,2,1,4,3,2,1,5,4,3,2,1,1,2,1,7,6,5,4,3,2,1,5,4,3,2,1,2,1,2,1,1],"label":["unlist","as.matrix.data.frame","as.matrix","apply","unlist","as.matrix.data.frame","as.matrix","apply","unlist","as.matrix.data.frame","as.matrix","apply","unlist","as.matrix.data.frame","as.matrix","apply","unlist","as.matrix.data.frame","as.matrix","apply","unlist","as.matrix.data.frame","as.matrix","apply","unlist","as.matrix.data.frame","as.matrix","apply","unlist","as.matrix.data.frame","as.matrix","apply","unlist","as.matrix.data.frame","as.matrix","apply","unlist","as.matrix.data.frame","as.matrix","apply","unlist","as.matrix.data.frame","as.matrix","apply","unlist","as.matrix.data.frame","as.matrix","apply","unlist","as.matrix.data.frame","as.matrix","apply","unlist","as.matrix.data.frame","as.matrix","apply","unlist","as.matrix.data.frame","as.matrix","apply","unlist","as.matrix.data.frame","as.matrix","apply","unlist","as.matrix.data.frame","as.matrix","apply","unlist","as.matrix.data.frame","as.matrix","apply","unlist","as.matrix.data.frame","as.matrix","apply","<GC>","aperm.default","aperm","apply","<GC>","aperm.default","aperm","apply","<GC>","aperm.default","aperm","apply","<GC>","aperm.default","aperm","apply","<GC>","aperm.default","aperm","apply","<GC>","aperm.default","aperm","apply","aperm.default","aperm","apply","aperm.default","aperm","apply","aperm.default","aperm","apply","aperm.default","aperm","apply","aperm.default","aperm","apply","aperm.default","aperm","apply","aperm.default","aperm","apply","aperm.default","aperm","apply","aperm.default","aperm","apply","aperm.default","aperm","apply","aperm.default","aperm","apply","aperm.default","aperm","apply","aperm.default","aperm","apply","aperm.default","aperm","apply","aperm.default","aperm","apply","aperm.default","aperm","apply","aperm.default","aperm","apply","aperm.default","aperm","apply","aperm.default","aperm","apply","aperm.default","aperm","apply","aperm.default","aperm","apply","aperm.default","aperm","apply","aperm.default","aperm","apply","mean.default","FUN","apply","apply","apply","apply","apply","apply","apply","apply","apply","apply","apply","apply","mean.default","FUN","apply","apply","apply","apply","mean.default","FUN","apply","apply","apply","<GC>","apply","apply","apply","mean.default","FUN","apply","apply","mean.default","FUN","apply","apply","mean.default","FUN","apply","apply","mean.default","FUN","apply","apply","mean.default","FUN","apply","apply","apply","apply","apply","apply","apply","apply","apply","apply","apply","apply","apply","apply","<GC>","apply","<GC>","apply","<GC>","apply","<GC>","apply","<GC>","apply","<GC>","apply","apply","apply","apply","apply","mean.default","FUN","apply","apply","mean.default","FUN","apply","apply","mean.default","FUN","apply","apply","mean.default","FUN","apply","apply","apply","apply","mean.default","FUN","apply","any","order","[<-.data.frame","[<-","[<-.data.frame","[<-","-","order","[<-.data.frame","[<-","[<-.data.frame","[<-","-","rep_len","order","[<-.data.frame","[<-","[<-.data.frame","[<-","[<-.data.frame","[<-","-","<GC>","order","[<-.data.frame","[<-","-","lapply","unlist","order","[<-.data.frame","[<-","-","match.fun","lapply","unlist","order","[<-.data.frame","[<-","-","vapply","order","[<-.data.frame","[<-",".row_names_info","[<-.data.frame","[<-","match.fun","lapply","unlist","order","[<-.data.frame","[<-","vapply","order","[<-.data.frame","[<-","[<-.data.frame","[<-","unlist","order","[<-.data.frame","[<-","-","match.fun","lapply","unlist","order","[<-.data.frame","[<-","-","FUN","vapply","order","[<-.data.frame","[<-","[<-.data.frame","[<-","<GC>","all","order","[<-.data.frame","[<-","vapply","order","[<-.data.frame","[<-","[<-.data.frame","[<-","match.fun","vapply","order","[<-.data.frame","[<-","[<-.data.frame","[<-","unlist","order","[<-.data.frame","[<-","[<-.data.frame","[<-","order","[<-.data.frame","[<-","<GC>","order","[<-.data.frame","[<-","<GC>","order","[<-.data.frame","[<-","-","[<-.data.frame","[<-","[<-.data.frame","[<-","lapply","unlist","order","[<-.data.frame","[<-","[<-.data.frame","[<-","[<-.data.frame","[<-","-","vapply","order","[<-.data.frame","[<-","-","<GC>","vapply","order","[<-.data.frame","[<-","<GC>","vapply","order","[<-.data.frame","[<-","<GC>","vapply","order","[<-.data.frame","[<-","<GC>","vapply","order","[<-.data.frame","[<-","<GC>","vapply","order","[<-.data.frame","[<-","<GC>","vapply","order","[<-.data.frame","[<-","order","[<-.data.frame","[<-","vapply","order","[<-.data.frame","[<-","-","FUN","vapply","[<-.data.frame","[<-","[<-.data.frame","[<-","unlist","order","[<-.data.frame","[<-","match.fun","vapply","order","[<-.data.frame","[<-","-","[<-.data.frame","[<-","<GC>","FUN","lapply","unlist","order","[<-.data.frame","[<-","match.fun","vapply","order","[<-.data.frame","[<-","[<-.data.frame","[<-","[<-.data.frame","[<-","-"],"filenum":[null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,1,1,1,1,1,1,1,1,1,1,1,null,null,1,1,1,1,null,null,1,1,1,null,1,1,1,null,null,1,1,null,null,1,1,null,null,1,1,null,null,1,1,null,null,1,1,1,1,1,1,1,1,1,1,1,1,1,1,null,1,null,1,null,1,null,1,null,1,null,1,1,1,1,1,null,null,1,1,null,null,1,1,null,null,1,1,null,null,1,1,1,1,null,null,1,null,null,1,1,1,1,1,null,1,1,1,1,1,null,null,1,1,1,1,1,1,1,null,null,1,1,1,null,null,null,1,1,1,null,null,null,null,1,1,1,null,null,1,1,null,1,1,null,null,null,null,1,1,null,null,1,1,1,1,null,null,1,1,1,null,null,null,null,1,1,1,null,null,null,1,1,1,1,null,null,null,1,1,null,null,1,1,1,1,null,null,null,1,1,1,1,null,null,1,1,1,1,null,1,1,null,null,1,1,null,null,1,1,1,1,1,1,1,null,null,null,1,1,1,1,1,1,1,null,null,1,1,1,null,null,null,1,1,null,null,null,1,1,null,null,null,1,1,null,null,null,1,1,null,null,null,1,1,null,null,null,1,1,null,1,1,null,null,1,1,1,null,null,1,1,1,1,null,null,1,1,null,null,null,1,1,1,1,1,null,null,null,null,null,1,1,null,null,null,1,1,1,1,1,1,1],"linenum":[null,null,null,11,null,null,null,11,null,null,null,11,null,null,null,11,null,null,null,11,null,null,null,11,null,null,null,11,null,null,null,11,null,null,null,11,null,null,null,11,null,null,null,11,null,null,null,11,null,null,null,11,null,null,null,11,null,null,null,11,null,null,null,11,null,null,null,11,null,null,null,11,null,null,null,11,null,null,null,11,null,null,null,11,null,null,null,11,null,null,null,11,null,null,null,11,null,null,null,11,null,null,11,null,null,11,null,null,11,null,null,11,null,null,11,null,null,11,null,null,11,null,null,11,null,null,11,null,null,11,null,null,11,null,null,11,null,null,11,null,null,11,null,null,11,null,null,11,null,null,11,null,null,11,null,null,11,null,null,11,null,null,11,null,null,11,null,null,11,null,null,11,11,11,11,11,11,11,11,11,11,11,11,null,null,11,11,11,11,null,null,11,11,11,null,11,11,11,null,null,11,11,null,null,11,11,null,null,11,11,null,null,11,11,null,null,11,11,11,11,11,11,11,11,11,11,11,11,11,11,null,11,null,11,null,11,null,11,null,11,null,11,11,11,11,11,null,null,11,11,null,null,11,11,null,null,11,11,null,null,11,11,11,11,null,null,11,null,null,15,15,15,15,15,null,15,15,15,15,15,null,null,15,15,15,15,15,15,15,null,null,15,15,15,null,null,null,15,15,15,null,null,null,null,15,15,15,null,null,15,15,null,15,15,null,null,null,null,15,15,null,null,15,15,15,15,null,null,15,15,15,null,null,null,null,15,15,15,null,null,null,15,15,15,15,null,null,null,15,15,null,null,15,15,15,15,null,null,null,15,15,15,15,null,null,15,15,15,15,null,15,15,null,null,15,15,null,null,15,15,15,15,15,15,15,null,null,null,15,15,15,15,15,15,15,null,null,15,15,15,null,null,null,15,15,null,null,null,15,15,null,null,null,15,15,null,null,null,15,15,null,null,null,15,15,null,null,null,15,15,null,15,15,null,null,15,15,15,null,null,15,15,15,15,null,null,15,15,null,null,null,15,15,15,15,15,null,null,null,null,null,15,15,null,null,null,15,15,15,15,15,15,15],"memalloc":[931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,931.043350219727,930.97998046875,930.97998046875,930.97998046875,930.97998046875,930.979827880859,930.979827880859,930.979827880859,930.979827880859,930.979827880859,930.979827880859,930.979827880859,930.979827880859,930.979827880859,930.979827880859,930.979827880859,930.979827880859,930.979827880859,930.979827880859,930.979827880859,930.979827880859,930.979827880859,930.979827880859,930.979827880859,930.979827880859,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1388.74346160889,1396.39220428467,1396.39220428467,1396.39220428467,1416.2287979126,1439.11723327637,1451.32443237305,1472.68692779541,1484.89410400391,1507.78253936768,1518.46379852295,1533.72275543213,1545.92993164062,1561.1888885498,1571.87014770508,1587.12916564941,1587.12916564941,1587.12916564941,1599.33628082275,1614.59523773193,1625.27649688721,1640.53551483154,1640.53551483154,1640.53551483154,1652.74263000488,1668.00158691406,1668.00160980225,1668.00160980225,1423.84375,1439.10270690918,1465.04298400879,1465.04298400879,1465.04298400879,1484.87957763672,1510.81985473633,1510.81985473633,1510.81985473633,1530.65644836426,1556.59672546387,1556.59672546387,1556.59672546387,1576.4333190918,1602.37359619141,1602.37359619141,1602.37359619141,1622.21018981934,1648.15046691895,1648.15046691895,1648.15046691895,1667.98706054688,1404.00736999512,1420.7922668457,1449.78424072266,1466.56913757324,1495.5611114502,1512.34600830078,1541.33798217773,1561.17463684082,1587.11485290527,1606.95150756836,1632.89172363281,1652.7283782959,1667.98735809326,1667.98735809326,1667.98735809326,1667.98735809326,1667.98735809326,1667.98735809326,1667.98735809326,1667.98735809326,1667.98735809326,1667.98735809326,1393.32630157471,1393.32630157471,1419.26649475098,1439.10314941406,1465.04336547852,1484.8800201416,1510.82029724121,1510.82029724121,1510.82029724121,1530.65689086914,1556.59716796875,1556.59716796875,1556.59716796875,1576.43376159668,1602.37403869629,1602.37403869629,1602.37403869629,1622.21063232422,1648.15090942383,1648.15090942383,1648.15090942383,1667.98750305176,1683.24645996094,1693.92771911621,1709.18673706055,1709.18673706055,1709.18673706055,1716.15056610107,1716.15056610107,1716.15056610107,1716.15056610107,1726.63597106934,1726.63597106934,1733.71771240234,1741.08065032959,1741.08065032959,1741.08065032959,1747.91724395752,1747.91724395752,1758.54241943359,1762.56703948975,1762.56703948975,1762.56703948975,1762.56703948975,1772.87155151367,1772.87155151367,1779.84564208984,1779.84564208984,1790.45989990234,1790.89279937744,1790.89279937744,1790.89279937744,1790.89279937744,1473.77505493164,1480.99339294434,1480.99339294434,1480.99339294434,1480.99339294434,1480.99339294434,1495.05337524414,1502.28377532959,1502.28377532959,1502.28377532959,1502.28377532959,1502.28377532959,1502.28377532959,1516.33169555664,1523.60424041748,1523.60424041748,1523.60424041748,1523.60424041748,1537.62105560303,1537.62105560303,1537.62105560303,1544.9398651123,1544.9398651123,1544.9398651123,1544.9398651123,1544.9398651123,1544.9398651123,1536.96572875977,1536.96572875977,1536.96572875977,1536.96572875977,1544.39068603516,1544.39068603516,1558.35562896729,1558.35562896729,1558.35562896729,1558.35562896729,1568.81494140625,1579.74240112305,1579.74240112305,1579.74240112305,1579.74240112305,1579.74240112305,1579.74240112305,1590.09326171875,1601.11112976074,1601.11112976074,1601.11112976074,1601.11112976074,1601.11112976074,1611.40082550049,1611.40082550049,1615.32681274414,1615.32681274414,1615.32681274414,1615.32681274414,1615.32681274414,1610.88414764404,1610.88414764404,1610.88414764404,1610.88414764404,1624.86908721924,1624.86908721924,1632.23780822754,1632.23780822754,1632.23780822754,1632.23780822754,1632.23780822754,1646.15552520752,1646.15552520752,1653.5101776123,1653.5101776123,1653.5101776123,1653.5101776123,1667.43446350098,1667.43446350098,1674.80046081543,1674.80046081543,1674.80046081543,1685.52701568604,1685.52701568604,1685.52701568604,1685.52701568604,1669.56242370605,1669.56242370605,1669.56242370605,1669.56242370605,1679.80786132812,1686.9322052002,1686.9322052002,1697.82630157471,1697.82630157471,1705.06552886963,1705.06552886963,1705.06552886963,1705.06552886963,1705.06552886963,1718.88938140869,1718.88938140869,1725.93946838379,1725.93946838379,1736.55004882812,1740.43295288086,1740.43295288086,1740.43295288086,1740.43295288086,1750.73559570312,1751.11731719971,1751.11731719971,1751.11731719971,1751.11731719971,1751.11731719971,1751.11731719971,1751.11731719971,1751.11731719971,1751.11731719971,1751.11731719971,1751.11731719971,1751.11731719971,1751.11731719971,1751.11731719971,1751.11731719971,1751.11731719971,1751.11731719971,1751.11731719971,1751.11731719971,1751.11731719971,1751.11731719971,1751.11731719971,1751.11731719971,1751.11731719971,1751.11731719971,824.220802307129,824.220802307129,824.220802307129,824.220802307129,824.220802307129,827.616554260254,827.616554260254,827.616554260254,838.490730285645,838.490730285645,838.490730285645,838.490730285645,848.663787841797,859.326049804688,859.326049804688,859.326049804688,859.326049804688,866.476028442383,866.476028442383,877.151405334473,877.151405334473,877.151405334473,877.151405334473,884.44303894043,884.44303894043,884.44303894043,884.44303894043,884.44303894043,898.313201904297,905.418502807617,905.418502807617,894.413536071777,894.413536071777,894.413536071777,894.413536071777,894.413536071777,894.413536071777,894.413536071777,901.310356140137,901.310356140137,901.310356140137,901.310356140137,901.310356140137,912.156845092773,912.156845092773,919.29842376709,919.29842376709,933.051078796387],"meminc":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-0.0633697509765625,0,0,0,-0.000152587890625,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,457.763633728027,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7.64874267578125,0,0,19.8365936279297,22.8884353637695,12.2071990966797,21.3624954223633,12.2071762084961,22.8884353637695,10.6812591552734,15.2589569091797,12.2071762084961,15.2589569091797,10.6812591552734,15.2590179443359,0,0,12.2071151733398,15.2589569091797,10.6812591552734,15.2590179443359,0,0,12.2071151733398,15.2589569091797,2.288818359375e-05,0,-244.157859802246,15.2589569091797,25.9402770996094,0,0,19.8365936279297,25.9402770996094,0,0,19.8365936279297,25.9402770996094,0,0,19.8365936279297,25.9402770996094,0,0,19.8365936279297,25.9402770996094,0,0,19.8365936279297,-263.979690551758,16.7848968505859,28.9919738769531,16.7848968505859,28.9919738769531,16.7848968505859,28.9919738769531,19.8366546630859,25.9402160644531,19.8366546630859,25.9402160644531,19.8366546630859,15.2589797973633,0,0,0,0,0,0,0,0,0,-274.661056518555,0,25.9401931762695,19.8366546630859,25.9402160644531,19.8366546630859,25.9402770996094,0,0,19.8365936279297,25.9402770996094,0,0,19.8365936279297,25.9402770996094,0,0,19.8365936279297,25.9402770996094,0,0,19.8365936279297,15.2589569091797,10.6812591552734,15.2590179443359,0,0,6.96382904052734,0,0,0,10.4854049682617,0,7.08174133300781,7.36293792724609,0,0,6.83659362792969,0,10.6251754760742,4.02462005615234,0,0,0,10.3045120239258,0,6.97409057617188,0,10.6142578125,0.432899475097656,0,0,0,-317.117744445801,7.21833801269531,0,0,0,0,14.0599822998047,7.23040008544922,0,0,0,0,0,14.0479202270508,7.27254486083984,0,0,0,14.0168151855469,0,0,7.31880950927734,0,0,0,0,0,-7.97413635253906,0,0,0,7.42495727539062,0,13.9649429321289,0,0,0,10.4593124389648,10.9274597167969,0,0,0,0,0,10.3508605957031,11.0178680419922,0,0,0,0,10.2896957397461,0,3.92598724365234,0,0,0,0,-4.44266510009766,0,0,0,13.9849395751953,0,7.36872100830078,0,0,0,0,13.9177169799805,0,7.35465240478516,0,0,0,13.9242858886719,0,7.36599731445312,0,0,10.7265548706055,0,0,0,-15.9645919799805,0,0,0,10.2454376220703,7.12434387207031,0,10.8940963745117,0,7.23922729492188,0,0,0,0,13.8238525390625,0,7.05008697509766,0,10.6105804443359,3.88290405273438,0,0,0,10.3026428222656,0.381721496582031,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-926.896514892578,0,0,0,0,3.395751953125,0,0,10.8741760253906,0,0,0,10.1730575561523,10.6622619628906,0,0,0,7.14997863769531,0,10.6753768920898,0,0,0,7.29163360595703,0,0,0,0,13.8701629638672,7.10530090332031,0,-11.0049667358398,0,0,0,0,0,0,6.89682006835938,0,0,0,0,10.8464889526367,0,7.14157867431641,0,13.7526550292969],"filename":[null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,null,"<expr>","<expr>","<expr>","<expr>",null,null,"<expr>","<expr>","<expr>",null,"<expr>","<expr>","<expr>",null,null,"<expr>","<expr>",null,null,"<expr>","<expr>",null,null,"<expr>","<expr>",null,null,"<expr>","<expr>",null,null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,"<expr>",null,"<expr>",null,"<expr>",null,"<expr>",null,"<expr>",null,"<expr>","<expr>","<expr>","<expr>","<expr>",null,null,"<expr>","<expr>",null,null,"<expr>","<expr>",null,null,"<expr>","<expr>",null,null,"<expr>","<expr>","<expr>","<expr>",null,null,"<expr>",null,null,"<expr>","<expr>","<expr>","<expr>","<expr>",null,"<expr>","<expr>","<expr>","<expr>","<expr>",null,null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,null,"<expr>","<expr>","<expr>",null,null,null,"<expr>","<expr>","<expr>",null,null,null,null,"<expr>","<expr>","<expr>",null,null,"<expr>","<expr>",null,"<expr>","<expr>",null,null,null,null,"<expr>","<expr>",null,null,"<expr>","<expr>","<expr>","<expr>",null,null,"<expr>","<expr>","<expr>",null,null,null,null,"<expr>","<expr>","<expr>",null,null,null,"<expr>","<expr>","<expr>","<expr>",null,null,null,"<expr>","<expr>",null,null,"<expr>","<expr>","<expr>","<expr>",null,null,null,"<expr>","<expr>","<expr>","<expr>",null,null,"<expr>","<expr>","<expr>","<expr>",null,"<expr>","<expr>",null,null,"<expr>","<expr>",null,null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,null,null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,null,"<expr>","<expr>","<expr>",null,null,null,"<expr>","<expr>",null,null,null,"<expr>","<expr>",null,null,null,"<expr>","<expr>",null,null,null,"<expr>","<expr>",null,null,null,"<expr>","<expr>",null,null,null,"<expr>","<expr>",null,"<expr>","<expr>",null,null,"<expr>","<expr>","<expr>",null,null,"<expr>","<expr>","<expr>","<expr>",null,null,"<expr>","<expr>",null,null,null,"<expr>","<expr>","<expr>","<expr>","<expr>",null,null,null,null,null,"<expr>","<expr>",null,null,null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>"]},"interval":10,"files":[{"filename":"<expr>","content":"# Generate data\ntimes <- 4e5\ncols <- 150\ndata <- as.data.frame(x = matrix(rnorm(times * cols, mean = 5), ncol = cols))\ndata <- cbind(id = paste0(\"g\", seq_len(times)), data)\n\nprofvis({\n  data1 <- data   # Store in another variable for this run\n\n  # Get column means\n  means <- apply(data1[, names(data1) != \"id\"], 2, mean)\n\n  # Subtract mean from each column\n  for (i in seq_along(means)) {\n    data1[, names(data1) != \"id\"][, i] <- data1[, names(data1) != \"id\"][, i] - means[i]\n  }\n})","normpath":"<expr>"}],"prof_output":"/tmp/Rtmp6M6RD8/file258051c731ec.prof","highlight":{"output":["^output\\$"],"gc":["^<GC>$"],"stacktrace":["^\\.\\.stacktraceo(n|ff)\\.\\.$"]},"split":"h"}},"evals":[],"jsHooks":[]}</script>
<p>Most of the time is spent in the <code>apply</code> call, so that’s the best candidate for a first pass at optimization. We can also see that the <code>apply</code> results in a lot of memory being allocated and deallocated. Memory “churning” is often a cause for performance problems.</p>
<p>Looking at the flame graph, we can see that <code>apply</code> calls <code>as.matrix</code> and <code>aperm</code>. These two functions convert the data frame to a matrix and transpose it – so even before we’ve done any useful computations, we’ve spent a large amount of time transforming the data.</p>
<p>We could try to speed this up in a number of ways. One possibility is that we could simply leave the data in matrix form (instead of putting it in a data frame in line 4). That would remove the need for the <code>as.matrix</code> call, but it would still require <code>aperm</code> to transpose the data. It would also lose the connection of each row to the <code>id</code> column, which is undesirable. In any case, using <code>apply</code> over columns looks like it will be expensive because of the call to <code>aperm</code>.</p>
<p>An obvious alternative is to use the <code>colMeans</code> function. But there’s also another possibility. Data frames are implemented as lists of vectors, where each column is one vector, so we could use <code>lapply</code> or <code>vapply</code> to apply the <code>mean</code> function over each column. Let’s compare the speed of these four different ways of getting column means.</p>
<pre class="r"><code>profvis({
  data1 &lt;- data
  # Four different ways of getting column means
  means &lt;- apply(data1[, names(data1) != &quot;id&quot;], 2, mean)
  means &lt;- colMeans(data1[, names(data1) != &quot;id&quot;])
  means &lt;- lapply(data1[, names(data1) != &quot;id&quot;], mean)
  means &lt;- vapply(data1[, names(data1) != &quot;id&quot;], mean, numeric(1))
})</code></pre>
<div id="htmlwidget-9249" style="width:100%;height:450px;" class="profvis html-widget"></div>
<script type="application/json" data-for="htmlwidget-9249">{"x":{"message":{"prof":{"time":[1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,6,6,6,6,7,7,7,7,8,8,8,8,9,9,9,9,10,10,10,10,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,14,15,15,15,15,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,20,20,20,21,21,21,22,22,22,23,23,23,24,24,24,25,25,25,26,26,26,27,27,27,28,28,28,29,29,29,30,30,30,31,31,31,32,32,32,33,33,33,34,34,34,35,35,35,36,36,36,37,37,37,38,38,38,39,39,39,40,40,40,41,41,41,42,42,42,43,43,43,44,44,44,45,46,47,48,49,49,49,50,51,52,53,54,55,56,56,57,57,57,58,59,60,60,60,61,62,63,64,64,64,65,66,67,68,68,68,69,69,70,71,71,71,72,73,74,75,76,77,78,78,78,79,80,81,81,82,82,83,83,84,84,85,85,86,86,87,88,88,88,89,89,89,90,91,92,93,93,93,94,95,96,97,97,97,98,99,100,101,102,102,102,103,104,105,106,106,106,107,108,109,110,110,110,111,112,113,113,113,114,114,114,115,116,117,117,117,118,118,118,119,120,121,122,123,123,123,124,124,124,125,126,127,128,129,129,130,131,131,131,132,133,133,133,133,134,134,134,134,135,135,135,135,136,136,136,136,137,137,137,137,138,138,138,138,139,139,139,139,140,140,140,140,141,141,141,141,142,142,142,142,143,143,143,143,144,144,144,144,145,145,145,145,146,146,146,146,147,147,147,147,148,148,148,148,149,149,149,149,150,150,150,150,151,151,151,151,152,152,152,152,153,153,153,153,154,154,154,154,155,155,155,155,156,156,156,156,157,157,157,157,158,158,158,158,159,159,159,159,160,160,160,160,161,161,161,161,162,162,162,162,163,163,163,163,164,164,164,164,165,165,165,165,166,166,166,166,167,167,167,167,168,168,168,168,169,169,169,169,170,170,170,170,171,171,171,171,172,172,172,172,173,174,175,176,177,178,179,180,180,180,181,181,181,182,182,182,183,183,183,184,184,184,185,185,185,186,186,186,187,187,187,188,188,188,189,189,189,190,190,190,191,191,191,192,192,192,193,193,193,194,194,194,195,195,195,196,196,196,197,197,197,198,198,198,199,199,199,200,200,200,201,201,201,202,202,202,203,203,203,204,204,204,205,205,205,206,206,206,207,207,207,208,208,208],"depth":[4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,1,1,1,1,3,2,1,1,1,1,1,1,1,2,1,3,2,1,1,1,3,2,1,1,1,1,3,2,1,1,1,1,3,2,1,2,1,1,3,2,1,1,1,1,1,1,1,3,2,1,1,1,2,1,2,1,2,1,2,1,2,1,2,1,1,3,2,1,3,2,1,1,1,1,3,2,1,1,1,1,3,2,1,1,1,1,1,3,2,1,1,1,1,3,2,1,1,1,1,3,2,1,1,1,3,2,1,3,2,1,1,1,3,2,1,3,2,1,1,1,1,1,3,2,1,3,2,1,1,1,1,1,2,1,1,3,2,1,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,1,1,1,1,1,1,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1],"label":["unlist","as.matrix.data.frame","as.matrix","apply","unlist","as.matrix.data.frame","as.matrix","apply","unlist","as.matrix.data.frame","as.matrix","apply","unlist","as.matrix.data.frame","as.matrix","apply","unlist","as.matrix.data.frame","as.matrix","apply","unlist","as.matrix.data.frame","as.matrix","apply","unlist","as.matrix.data.frame","as.matrix","apply","unlist","as.matrix.data.frame","as.matrix","apply","unlist","as.matrix.data.frame","as.matrix","apply","unlist","as.matrix.data.frame","as.matrix","apply","unlist","as.matrix.data.frame","as.matrix","apply","unlist","as.matrix.data.frame","as.matrix","apply","unlist","as.matrix.data.frame","as.matrix","apply","unlist","as.matrix.data.frame","as.matrix","apply","unlist","as.matrix.data.frame","as.matrix","apply","unlist","as.matrix.data.frame","as.matrix","apply","unlist","as.matrix.data.frame","as.matrix","apply","unlist","as.matrix.data.frame","as.matrix","apply","aperm.default","aperm","apply","aperm.default","aperm","apply","aperm.default","aperm","apply","aperm.default","aperm","apply","aperm.default","aperm","apply","aperm.default","aperm","apply","aperm.default","aperm","apply","aperm.default","aperm","apply","aperm.default","aperm","apply","aperm.default","aperm","apply","aperm.default","aperm","apply","aperm.default","aperm","apply","aperm.default","aperm","apply","aperm.default","aperm","apply","aperm.default","aperm","apply","aperm.default","aperm","apply","aperm.default","aperm","apply","aperm.default","aperm","apply","aperm.default","aperm","apply","aperm.default","aperm","apply","aperm.default","aperm","apply","aperm.default","aperm","apply","aperm.default","aperm","apply","aperm.default","aperm","apply","aperm.default","aperm","apply","aperm.default","aperm","apply","apply","apply","apply","apply","mean.default","FUN","apply","apply","apply","apply","apply","apply","apply","<GC>","apply","mean.default","FUN","apply","apply","apply","mean.default","FUN","apply","apply","apply","apply","mean.default","FUN","apply","apply","apply","apply","mean.default","FUN","apply","<GC>","apply","apply","mean.default","FUN","apply","apply","apply","apply","apply","apply","apply","mean.default","FUN","apply","apply","apply","<GC>","apply","<GC>","apply","<GC>","apply","<GC>","apply","<GC>","apply","<GC>","apply","apply","mean.default","FUN","apply","mean.default","FUN","apply","apply","apply","apply","mean.default","FUN","apply","apply","apply","apply","mean.default","FUN","apply","apply","apply","apply","apply","mean.default","FUN","apply","apply","apply","apply","mean.default","FUN","apply","apply","apply","apply","mean.default","FUN","apply","apply","apply","mean.default","FUN","apply","mean.default","FUN","apply","apply","apply","mean.default","FUN","apply","mean.default","FUN","apply","apply","apply","apply","apply","mean.default","FUN","apply","mean.default","FUN","apply","apply","apply","apply","apply","<GC>","apply","apply","mean.default","FUN","apply","apply","unlist","as.matrix.data.frame","as.matrix","colMeans","unlist","as.matrix.data.frame","as.matrix","colMeans","unlist","as.matrix.data.frame","as.matrix","colMeans","unlist","as.matrix.data.frame","as.matrix","colMeans","unlist","as.matrix.data.frame","as.matrix","colMeans","unlist","as.matrix.data.frame","as.matrix","colMeans","unlist","as.matrix.data.frame","as.matrix","colMeans","unlist","as.matrix.data.frame","as.matrix","colMeans","unlist","as.matrix.data.frame","as.matrix","colMeans","unlist","as.matrix.data.frame","as.matrix","colMeans","unlist","as.matrix.data.frame","as.matrix","colMeans","unlist","as.matrix.data.frame","as.matrix","colMeans","unlist","as.matrix.data.frame","as.matrix","colMeans","unlist","as.matrix.data.frame","as.matrix","colMeans","unlist","as.matrix.data.frame","as.matrix","colMeans","unlist","as.matrix.data.frame","as.matrix","colMeans","unlist","as.matrix.data.frame","as.matrix","colMeans","unlist","as.matrix.data.frame","as.matrix","colMeans","unlist","as.matrix.data.frame","as.matrix","colMeans","unlist","as.matrix.data.frame","as.matrix","colMeans","unlist","as.matrix.data.frame","as.matrix","colMeans","unlist","as.matrix.data.frame","as.matrix","colMeans","unlist","as.matrix.data.frame","as.matrix","colMeans","unlist","as.matrix.data.frame","as.matrix","colMeans","unlist","as.matrix.data.frame","as.matrix","colMeans","unlist","as.matrix.data.frame","as.matrix","colMeans","unlist","as.matrix.data.frame","as.matrix","colMeans","unlist","as.matrix.data.frame","as.matrix","colMeans","unlist","as.matrix.data.frame","as.matrix","colMeans","unlist","as.matrix.data.frame","as.matrix","colMeans","unlist","as.matrix.data.frame","as.matrix","colMeans","unlist","as.matrix.data.frame","as.matrix","colMeans","unlist","as.matrix.data.frame","as.matrix","colMeans","unlist","as.matrix.data.frame","as.matrix","colMeans","unlist","as.matrix.data.frame","as.matrix","colMeans","unlist","as.matrix.data.frame","as.matrix","colMeans","unlist","as.matrix.data.frame","as.matrix","colMeans","unlist","as.matrix.data.frame","as.matrix","colMeans","unlist","as.matrix.data.frame","as.matrix","colMeans","unlist","as.matrix.data.frame","as.matrix","colMeans","colMeans","colMeans","colMeans","colMeans","colMeans","colMeans","colMeans","mean.default","FUN","lapply","mean.default","FUN","lapply","mean.default","FUN","lapply","mean.default","FUN","lapply","mean.default","FUN","lapply","mean.default","FUN","lapply","mean.default","FUN","lapply","mean.default","FUN","lapply","mean.default","FUN","lapply","mean.default","FUN","lapply","mean.default","FUN","lapply","mean.default","FUN","lapply","mean.default","FUN","lapply","mean.default","FUN","lapply","mean.default","FUN","vapply","mean.default","FUN","vapply","mean.default","FUN","vapply","mean.default","FUN","vapply","mean.default","FUN","vapply","mean.default","FUN","vapply","mean.default","FUN","vapply","mean.default","FUN","vapply","mean.default","FUN","vapply","mean.default","FUN","vapply","mean.default","FUN","vapply","mean.default","FUN","vapply","mean.default","FUN","vapply","mean.default","FUN","vapply","mean.default","FUN","vapply"],"filenum":[null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,1,1,1,1,null,null,1,1,1,1,1,1,1,null,1,null,null,1,1,1,null,null,1,1,1,1,null,null,1,1,1,1,null,null,1,null,1,1,null,null,1,1,1,1,1,1,1,null,null,1,1,1,null,1,null,1,null,1,null,1,null,1,null,1,1,null,null,1,null,null,1,1,1,1,null,null,1,1,1,1,null,null,1,1,1,1,1,null,null,1,1,1,1,null,null,1,1,1,1,null,null,1,1,1,null,null,1,null,null,1,1,1,null,null,1,null,null,1,1,1,1,1,null,null,1,null,null,1,1,1,1,1,null,1,1,null,null,1,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,null,null,null,1,1,1,1,1,1,1,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1],"linenum":[null,null,null,4,null,null,null,4,null,null,null,4,null,null,null,4,null,null,null,4,null,null,null,4,null,null,null,4,null,null,null,4,null,null,null,4,null,null,null,4,null,null,null,4,null,null,null,4,null,null,null,4,null,null,null,4,null,null,null,4,null,null,null,4,null,null,null,4,null,null,null,4,null,null,4,null,null,4,null,null,4,null,null,4,null,null,4,null,null,4,null,null,4,null,null,4,null,null,4,null,null,4,null,null,4,null,null,4,null,null,4,null,null,4,null,null,4,null,null,4,null,null,4,null,null,4,null,null,4,null,null,4,null,null,4,null,null,4,null,null,4,null,null,4,null,null,4,null,null,4,4,4,4,4,null,null,4,4,4,4,4,4,4,null,4,null,null,4,4,4,null,null,4,4,4,4,null,null,4,4,4,4,null,null,4,null,4,4,null,null,4,4,4,4,4,4,4,null,null,4,4,4,null,4,null,4,null,4,null,4,null,4,null,4,4,null,null,4,null,null,4,4,4,4,null,null,4,4,4,4,null,null,4,4,4,4,4,null,null,4,4,4,4,null,null,4,4,4,4,null,null,4,4,4,null,null,4,null,null,4,4,4,null,null,4,null,null,4,4,4,4,4,null,null,4,null,null,4,4,4,4,4,null,4,4,null,null,4,4,null,null,null,5,null,null,null,5,null,null,null,5,null,null,null,5,null,null,null,5,null,null,null,5,null,null,null,5,null,null,null,5,null,null,null,5,null,null,null,5,null,null,null,5,null,null,null,5,null,null,null,5,null,null,null,5,null,null,null,5,null,null,null,5,null,null,null,5,null,null,null,5,null,null,null,5,null,null,null,5,null,null,null,5,null,null,null,5,null,null,null,5,null,null,null,5,null,null,null,5,null,null,null,5,null,null,null,5,null,null,null,5,null,null,null,5,null,null,null,5,null,null,null,5,null,null,null,5,null,null,null,5,null,null,null,5,null,null,null,5,null,null,null,5,null,null,null,5,null,null,null,5,null,null,null,5,null,null,null,5,5,5,5,5,5,5,5,null,null,6,null,null,6,null,null,6,null,null,6,null,null,6,null,null,6,null,null,6,null,null,6,null,null,6,null,null,6,null,null,6,null,null,6,null,null,6,null,null,6,null,null,7,null,null,7,null,null,7,null,null,7,null,null,7,null,null,7,null,null,7,null,null,7,null,null,7,null,null,7,null,null,7,null,null,7,null,null,7,null,null,7,null,null,7],"memalloc":[1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1388.8991317749,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1846.66429138184,1858.87265777588,1871.07985687256,1889.39057159424,1900.07183074951,1915.33084869385,1915.33084869385,1915.33084869385,1927.53796386719,1942.79692077637,1953.47817993164,1968.73713684082,1980.94431304932,1996.2032699585,2000.78099060059,2000.78099060059,1854.27577972412,1854.27577972412,1854.27577972412,1866.48289489746,1881.74185180664,1892.42317199707,1892.42317199707,1892.42317199707,1912.259765625,1919.88924407959,1935.14820098877,1945.8295211792,1945.8295211792,1945.8295211792,1965.66611480713,1973.29559326172,1991.60633087158,1999.23587036133,1999.23587036133,1999.23587036133,1848.17218017578,1848.17218017578,1854.27571868896,1869.5347366333,1869.5347366333,1869.5347366333,1881.74185180664,1897.00080871582,1912.259765625,1927.51872253418,1935.14820098877,1953.45893859863,1961.08847808838,1961.08847808838,1961.08847808838,1980.92507171631,1991.60633087158,2000.76174926758,2000.76174926758,2000.76174926758,2000.76174926758,2000.76174926758,2000.76174926758,2000.76174926758,2000.76174926758,2000.76174926758,2000.76174926758,1390.409034729,1390.409034729,1393.45919036865,1419.39946746826,1419.39946746826,1419.39946746826,1434.65842437744,1434.65842437744,1434.65842437744,1454.49504089355,1469.75397491455,1492.64241027832,1503.32373046875,1503.32373046875,1503.32373046875,1523.16032409668,1538.41928100586,1561.30771636963,1571.98903656006,1571.98903656006,1571.98903656006,1591.82563018799,1607.08458709717,1629.97302246094,1640.65428161621,1655.91329956055,1655.91329956055,1655.91329956055,1668.12041473389,1683.37937164307,1694.06063079834,1709.31964874268,1709.31964874268,1709.31964874268,1721.52676391602,1736.7857208252,1747.46697998047,1762.7259979248,1762.7259979248,1762.7259979248,1774.93311309814,1790.19207000732,1800.87339019775,1800.87339019775,1800.87339019775,1816.13234710693,1816.13234710693,1816.13234710693,1828.33946228027,1843.59841918945,1854.27973937988,1854.27973937988,1854.27973937988,1869.53869628906,1869.53869628906,1869.53869628906,1881.7458114624,1897.00476837158,1904.63424682617,1919.89320373535,1930.57452392578,1930.57452392578,1930.57452392578,1945.83348083496,1945.83348083496,1945.83348083496,1958.0405960083,1973.29955291748,1980.92903137207,1999.23976898193,2000.76570892334,2000.76570892334,1420.92587280273,1439.23667144775,1439.23667144775,1439.23667144775,1466.70274353027,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.55935668945,1927.5618057251,1927.5618057251,1927.5618057251,1927.5618057251,1927.5618057251,1927.5618057251,1927.5618057251,1927.57171630859,1927.57171630859,1927.57171630859,1927.57219696045,1927.57219696045,1927.57219696045,1927.57283782959,1927.57283782959,1927.57283782959,1927.57326507568,1927.57326507568,1927.57326507568,1927.57395935059,1927.57395935059,1927.57395935059,1927.57438659668,1927.57438659668,1927.57438659668,1927.57502746582,1927.57502746582,1927.57502746582,1927.57550811768,1927.57550811768,1927.57550811768,1927.57614898682,1927.57614898682,1927.57614898682,1927.57657623291,1927.57657623291,1927.57657623291,1927.57727050781,1927.57727050781,1927.57727050781,1927.57769775391,1927.57769775391,1927.57769775391,1927.57833862305,1927.57833862305,1927.57833862305,1927.5788192749,1927.5788192749,1927.5788192749,1927.58905029297,1927.58905029297,1927.58905029297,1927.58947753906,1927.58947753906,1927.58947753906,1927.59017181396,1927.59017181396,1927.59017181396,1927.59059906006,1927.59059906006,1927.59059906006,1927.5912399292,1927.5912399292,1927.5912399292,1927.59166717529,1927.59166717529,1927.59166717529,1927.5923614502,1927.5923614502,1927.5923614502,1927.59278869629,1927.59278869629,1927.59278869629,1927.59342956543,1927.59342956543,1927.59342956543,1927.59385681152,1927.59385681152,1927.59385681152,1927.59455108643,1927.59455108643,1927.59455108643,1927.59497833252,1927.59497833252,1927.59497833252,1927.59561920166,1927.59561920166,1927.59561920166,1927.59609985352,1927.59609985352,1927.59609985352,1927.59674072266,1927.59674072266,1927.59674072266],"meminc":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,457.765159606934,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12.208366394043,12.2071990966797,18.3107147216797,10.6812591552734,15.2590179443359,0,0,12.2071151733398,15.2589569091797,10.6812591552734,15.2589569091797,12.2071762084961,15.2589569091797,4.57772064208984,0,-146.505210876465,0,0,12.2071151733398,15.2589569091797,10.6813201904297,0,0,19.8365936279297,7.62947845458984,15.2589569091797,10.6813201904297,0,0,19.8365936279297,7.62947845458984,18.3107376098633,7.62953948974609,0,0,-151.063690185547,0,6.10353851318359,15.2590179443359,0,0,12.2071151733398,15.2589569091797,15.2589569091797,15.2589569091797,7.62947845458984,18.3107376098633,7.62953948974609,0,0,19.8365936279297,10.6812591552734,9.15541839599609,0,0,0,0,0,0,0,0,0,-610.352714538574,0,3.05015563964844,25.9402770996094,0,0,15.2589569091797,0,0,19.8366165161133,15.2589340209961,22.8884353637695,10.6813201904297,0,0,19.8365936279297,15.2589569091797,22.8884353637695,10.6813201904297,0,0,19.8365936279297,15.2589569091797,22.8884353637695,10.6812591552734,15.2590179443359,0,0,12.2071151733398,15.2589569091797,10.6812591552734,15.2590179443359,0,0,12.2071151733398,15.2589569091797,10.6812591552734,15.2590179443359,0,0,12.2071151733398,15.2589569091797,10.6813201904297,0,0,15.2589569091797,0,0,12.2071151733398,15.2589569091797,10.6813201904297,0,0,15.2589569091797,0,0,12.2071151733398,15.2589569091797,7.62947845458984,15.2589569091797,10.6813201904297,0,0,15.2589569091797,0,0,12.2071151733398,15.2589569091797,7.62947845458984,18.3107376098633,1.52593994140625,0,-579.839836120605,18.3107986450195,0,0,27.4660720825195,460.85661315918,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.00244903564453125,0,0,0,0,0,0,0.00991058349609375,0,0,0.00048065185546875,0,0,0.000640869140625,0,0,0.00042724609375,0,0,0.00069427490234375,0,0,0.00042724609375,0,0,0.000640869140625,0,0,0.00048065185546875,0,0,0.000640869140625,0,0,0.00042724609375,0,0,0.00069427490234375,0,0,0.00042724609375,0,0,0.000640869140625,0,0,0.00048065185546875,0,0,0.0102310180664062,0,0,0.00042724609375,0,0,0.00069427490234375,0,0,0.00042724609375,0,0,0.000640869140625,0,0,0.00042724609375,0,0,0.00069427490234375,0,0,0.00042724609375,0,0,0.000640869140625,0,0,0.00042724609375,0,0,0.00069427490234375,0,0,0.00042724609375,0,0,0.000640869140625,0,0,0.00048065185546875,0,0,0.000640869140625,0,0],"filename":[null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>","<expr>","<expr>","<expr>","<expr>",null,null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,"<expr>",null,null,"<expr>","<expr>","<expr>",null,null,"<expr>","<expr>","<expr>","<expr>",null,null,"<expr>","<expr>","<expr>","<expr>",null,null,"<expr>",null,"<expr>","<expr>",null,null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,null,"<expr>","<expr>","<expr>",null,"<expr>",null,"<expr>",null,"<expr>",null,"<expr>",null,"<expr>",null,"<expr>","<expr>",null,null,"<expr>",null,null,"<expr>","<expr>","<expr>","<expr>",null,null,"<expr>","<expr>","<expr>","<expr>",null,null,"<expr>","<expr>","<expr>","<expr>","<expr>",null,null,"<expr>","<expr>","<expr>","<expr>",null,null,"<expr>","<expr>","<expr>","<expr>",null,null,"<expr>","<expr>","<expr>",null,null,"<expr>",null,null,"<expr>","<expr>","<expr>",null,null,"<expr>",null,null,"<expr>","<expr>","<expr>","<expr>","<expr>",null,null,"<expr>",null,null,"<expr>","<expr>","<expr>","<expr>","<expr>",null,"<expr>","<expr>",null,null,"<expr>","<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>",null,null,null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>"]},"interval":10,"files":[{"filename":"<expr>","content":"profvis({\n  data1 <- data\n  # Four different ways of getting column means\n  means <- apply(data1[, names(data1) != \"id\"], 2, mean)\n  means <- colMeans(data1[, names(data1) != \"id\"])\n  means <- lapply(data1[, names(data1) != \"id\"], mean)\n  means <- vapply(data1[, names(data1) != \"id\"], mean, numeric(1))\n})","normpath":"<expr>"}],"prof_output":"/tmp/Rtmp6M6RD8/file25802608b94e.prof","highlight":{"output":["^output\\$"],"gc":["^<GC>$"],"stacktrace":["^\\.\\.stacktraceo(n|ff)\\.\\.$"]},"split":"h"}},"evals":[],"jsHooks":[]}</script>
<p><code>colMeans</code> is about 6x faster than using <code>apply</code> with <code>mean</code>, but it looks like it’s still using <code>as.matrix</code>, which takes a significant amount of time. <code>lapply</code>/<code>vapply</code>are faster yet – about 10x faster than <code>apply</code>. <code>lapply</code> returns the values in a list, while <code>vapply</code> returns the values in a numeric vector, which is the form that we want, so it looks like <code>vapply</code> is the way to go for this part.</p>
<p>(If you want finer-grained comparisons of code performance, you can use the <a href="https://cran.r-project.org/web/packages/microbenchmark/index.html">microbenchmark</a> package. There’s more information about microbenchmark in the <a href="http://adv-r.had.co.nz/Profiling.html#code-organisation">profiling</a> chapter of Hadley Wickham’s book, <em>Advanced R</em>.)</p>
<p>You can also see that the faster methods also result in less memory allocation and deallocation. This is not a coincidence – allocating and deallocating memory can be expensive.</p>
<p>Let’s take the original code and replace <code>apply</code> with <code>vapply</code>:</p>
<pre class="r"><code>profvis({
  data1 &lt;- data
  means &lt;- vapply(data1[, names(data1) != &quot;id&quot;], mean, numeric(1))

  for (i in seq_along(means)) {
    data1[, names(data1) != &quot;id&quot;][, i] &lt;- data1[, names(data1) != &quot;id&quot;][, i] - means[i]
  }
})</code></pre>
<div id="htmlwidget-1030" style="width:100%;height:450px;" class="profvis html-widget"></div>
<script type="application/json" data-for="htmlwidget-1030">{"x":{"message":{"prof":{"time":[1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7,8,8,8,9,9,9,10,10,10,11,11,11,12,12,12,13,13,13,14,14,14,15,16,16,17,17,17,18,18,18,19,19,19,19,19,20,20,20,21,21,21,21,21,21,22,22,22,22,23,23,23,24,24,24,24,25,25,25,25,25,26,26,26,26,27,28,29,29,29,30,30,30,30,30,31,31,32,32,32,32,33,34,35,35,35,36,36,36,37,37,37,37,38,38,38,39,40,40,40,41,41,41,42,42,42,42,42,43,43,43,44,45,45,46,46,46,47,47,47,47,48,48,48,49,49,49,49,50,50,51,51,51,51,51,52,52,52,52,53,54,55,55,56,56,56,56,56,57,57,57,57,58,58,58,58,59,60,60,60,60,61,61,62,62,62,63,64,65,66,66,67,67,67,68,68,68,69,69,69,69,69,70,71,71,71,72,72,72,72,72,73,73,74,74,74,74,74,75],"depth":[3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,1,2,1,3,2,1,3,2,1,5,4,3,2,1,3,2,1,6,5,4,3,2,1,4,3,2,1,3,2,1,4,3,2,1,5,4,3,2,1,4,3,2,1,1,1,3,2,1,5,4,3,2,1,2,1,4,3,2,1,1,1,3,2,1,3,2,1,4,3,2,1,3,2,1,1,3,2,1,3,2,1,5,4,3,2,1,3,2,1,1,2,1,3,2,1,4,3,2,1,3,2,1,4,3,2,1,2,1,5,4,3,2,1,4,3,2,1,1,1,2,1,5,4,3,2,1,4,3,2,1,4,3,2,1,1,4,3,2,1,2,1,3,2,1,1,1,1,2,1,3,2,1,3,2,1,5,4,3,2,1,1,3,2,1,5,4,3,2,1,2,1,5,4,3,2,1,1],"label":["mean.default","FUN","vapply","mean.default","FUN","vapply","mean.default","FUN","vapply","mean.default","FUN","vapply","mean.default","FUN","vapply","mean.default","FUN","vapply","mean.default","FUN","vapply","mean.default","FUN","vapply","mean.default","FUN","vapply","mean.default","FUN","vapply","mean.default","FUN","vapply","mean.default","FUN","vapply","mean.default","FUN","vapply","mean.default","FUN","vapply","-","[<-.data.frame","[<-","order","[<-.data.frame","[<-","order","[<-.data.frame","[<-","lapply","unlist","order","[<-.data.frame","[<-","order","[<-.data.frame","[<-","match.fun","lapply","unlist","order","[<-.data.frame","[<-","vapply","order","[<-.data.frame","[<-","vapply","[<-.data.frame","[<-","unlist","order","[<-.data.frame","[<-","lapply","unlist","order","[<-.data.frame","[<-","unlist","order","[<-.data.frame","[<-","-","data1[, names(data1) != \"id\"][, i] <- data1[, names(data1) != \"id\"][, i] - means[i]","order","[<-.data.frame","[<-","match.fun","vapply","order","[<-.data.frame","[<-","[<-.data.frame","[<-","unlist","order","[<-.data.frame","[<-","-","-","order","[<-.data.frame","[<-","order","[<-.data.frame","[<-","unlist","order","[<-.data.frame","[<-","order","[<-.data.frame","[<-","-","order","[<-.data.frame","[<-","order","[<-.data.frame","[<-","<GC>","FUN","vapply","[<-.data.frame","[<-",".subset","[.data.frame","[","-","[<-.data.frame","[<-","order","[<-.data.frame","[<-","all","order","[<-.data.frame","[<-","order","[<-.data.frame","[<-","rep_len","order","[<-.data.frame","[<-","[<-.data.frame","[<-","<GC>","rep_len","order","[<-.data.frame","[<-","vapply","order","[<-.data.frame","[<-","-","-","[<-.data.frame","[<-","match.fun","vapply","order","[<-.data.frame","[<-","rep_len","order","[<-.data.frame","[<-","vapply","order","[<-.data.frame","[<-","-","<GC>","order","[<-.data.frame","[<-","[<-.data.frame","[<-","order","[<-.data.frame","[<-","-","-","-","[<-.data.frame","[<-","order","[<-.data.frame","[<-","order","[<-.data.frame","[<-","<GC>","vapply","order","[<-.data.frame","[<-","-","vapply","[<-.data.frame","[<-","lapply","unlist","order","[<-.data.frame","[<-","[<-.data.frame","[<-","lapply","unlist","order","[<-.data.frame","[<-","-"],"filenum":[null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,1,1,1,null,1,1,null,1,1,null,null,null,1,1,null,1,1,null,null,null,null,1,1,null,null,1,1,null,1,1,null,null,1,1,null,null,null,1,1,null,null,1,1,1,1,null,1,1,null,null,null,1,1,1,1,null,null,1,1,1,1,null,1,1,null,1,1,null,null,1,1,null,1,1,1,null,1,1,null,1,1,null,null,null,1,1,null,1,1,1,1,1,null,1,1,null,null,1,1,null,1,1,null,null,1,1,1,1,null,null,null,1,1,null,null,1,1,1,1,1,1,null,null,null,1,1,null,null,1,1,null,null,1,1,1,null,null,1,1,1,1,null,1,1,1,1,1,1,1,null,1,1,null,1,1,null,null,null,1,1,1,null,1,1,null,null,null,1,1,1,1,null,null,null,1,1,1],"linenum":[null,null,3,null,null,3,null,null,3,null,null,3,null,null,3,null,null,3,null,null,3,null,null,3,null,null,3,null,null,3,null,null,3,null,null,3,null,null,3,null,null,3,6,6,6,null,6,6,null,6,6,null,null,null,6,6,null,6,6,null,null,null,null,6,6,null,null,6,6,null,6,6,null,null,6,6,null,null,null,6,6,null,null,6,6,6,6,null,6,6,null,null,null,6,6,6,6,null,null,6,6,6,6,null,6,6,null,6,6,null,null,6,6,null,6,6,6,null,6,6,null,6,6,null,null,null,6,6,null,6,6,6,6,6,null,6,6,null,null,6,6,null,6,6,null,null,6,6,6,6,null,null,null,6,6,null,null,6,6,6,6,6,6,null,null,null,6,6,null,null,6,6,null,null,6,6,6,null,null,6,6,6,6,null,6,6,6,6,6,6,6,null,6,6,null,6,6,null,null,null,6,6,6,null,6,6,null,null,null,6,6,6,6,null,null,null,6,6,6],"memalloc":[473.401626586914,473.401626586914,473.401626586914,473.40210723877,473.40210723877,473.40210723877,473.40274810791,473.40274810791,473.40274810791,473.403175354004,473.403175354004,473.403175354004,473.403816223145,473.403816223145,473.403816223145,473.404296875,473.404296875,473.404296875,473.404937744141,473.404937744141,473.404937744141,473.405364990234,473.405364990234,473.405364990234,473.406059265137,473.406059265137,473.406059265137,473.40648651123,473.40648651123,473.40648651123,473.407127380371,473.407127380371,473.407127380371,473.407608032227,473.407608032227,473.407608032227,473.408248901367,473.408248901367,473.408248901367,473.408676147461,473.408676147461,473.408676147461,483.561515808105,490.684288024902,490.684288024902,501.521423339844,501.521423339844,501.521423339844,508.717361450195,508.717361450195,508.717361450195,519.262481689453,519.262481689453,519.262481689453,519.262481689453,519.262481689453,526.292015075684,526.292015075684,526.292015075684,536.88890838623,536.88890838623,536.88890838623,536.88890838623,536.88890838623,536.88890838623,543.897277832031,543.897277832031,543.897277832031,543.897277832031,554.511741638184,554.511741638184,554.511741638184,543.724624633789,543.724624633789,543.724624633789,543.724624633789,554.556648254395,554.556648254395,554.556648254395,554.556648254395,554.556648254395,561.757919311523,561.757919311523,561.757919311523,561.757919311523,575.474311828613,582.568237304688,593.322822570801,593.322822570801,593.322822570801,600.508926391602,600.508926391602,600.508926391602,600.508926391602,600.508926391602,611.1962890625,611.1962890625,618.301208496094,618.301208496094,618.301208496094,618.301208496094,614.007667541504,621.100440979004,631.777732849121,631.777732849121,631.777732849121,638.951988220215,638.951988220215,638.951988220215,649.841201782227,649.841201782227,649.841201782227,649.841201782227,657.048439025879,657.048439025879,657.048439025879,670.749855041504,677.853973388672,677.853973388672,677.853973388672,688.550155639648,688.550155639648,688.550155639648,692.051139831543,692.051139831543,692.051139831543,692.051139831543,692.051139831543,688.50732421875,688.50732421875,688.50732421875,698.657455444336,709.325584411621,709.325584411621,716.48486328125,716.48486328125,716.48486328125,727.250549316406,727.250549316406,727.250549316406,727.250549316406,734.448753356934,734.448753356934,734.448753356934,744.816795349121,744.816795349121,744.816795349121,744.816795349121,751.915481567383,751.915481567383,759.150009155273,759.150009155273,759.150009155273,759.150009155273,759.150009155273,751.749908447266,751.749908447266,751.749908447266,751.749908447266,765.629104614258,772.721878051758,783.394073486328,783.394073486328,790.58235168457,790.58235168457,790.58235168457,790.58235168457,790.58235168457,801.315032958984,801.315032958984,801.315032958984,801.315032958984,808.51619720459,808.51619720459,808.51619720459,808.51619720459,819.319534301758,826.359634399414,826.359634399414,826.359634399414,826.359634399414,822.095237731934,822.095237731934,829.31470489502,829.31470489502,829.31470489502,843.181755065918,850.274528503418,860.913688659668,868.035278320312,868.035278320312,878.771835327148,878.771835327148,878.771835327148,885.984580993652,885.984580993652,885.984580993652,896.491065979004,896.491065979004,896.491065979004,896.491065979004,896.491065979004,888.888740539551,899.551490783691,899.551490783691,899.551490783691,906.698028564453,906.698028564453,906.698028564453,906.698028564453,906.698028564453,917.539024353027,917.539024353027,924.731315612793,924.731315612793,924.731315612793,924.731315612793,924.731315612793,938.538154602051],"meminc":[0,0,0,0.00048065185546875,0,0,0.000640869140625,0,0,0.00042724609375,0,0,0.000640869140625,0,0,0.00048065185546875,0,0,0.000640869140625,0,0,0.00042724609375,0,0,0.00069427490234375,0,0,0.00042724609375,0,0,0.000640869140625,0,0,0.00048065185546875,0,0,0.000640869140625,0,0,0.00042724609375,0,0,10.1528396606445,7.12277221679688,0,10.8371353149414,0,0,7.19593811035156,0,0,10.5451202392578,0,0,0,0,7.02953338623047,0,0,10.5968933105469,0,0,0,0,0,7.00836944580078,0,0,0,10.6144638061523,0,0,-10.7871170043945,0,0,0,10.8320236206055,0,0,0,0,7.20127105712891,0,0,0,13.7163925170898,7.09392547607422,10.7545852661133,0,0,7.18610382080078,0,0,0,0,10.6873626708984,0,7.10491943359375,0,0,0,-4.29354095458984,7.0927734375,10.6772918701172,0,0,7.17425537109375,0,0,10.8892135620117,0,0,0,7.20723724365234,0,0,13.701416015625,7.10411834716797,0,0,10.6961822509766,0,0,3.50098419189453,0,0,0,0,-3.54381561279297,0,0,10.1501312255859,10.6681289672852,0,7.15927886962891,0,0,10.7656860351562,0,0,0,7.19820404052734,0,0,10.3680419921875,0,0,0,7.09868621826172,0,7.23452758789062,0,0,0,0,-7.40010070800781,0,0,0,13.8791961669922,7.0927734375,10.6721954345703,0,7.18827819824219,0,0,0,0,10.7326812744141,0,0,0,7.20116424560547,0,0,0,10.803337097168,7.04010009765625,0,0,0,-4.26439666748047,0,7.21946716308594,0,0,13.8670501708984,7.0927734375,10.63916015625,7.12158966064453,0,10.7365570068359,0,0,7.21274566650391,0,0,10.5064849853516,0,0,0,0,-7.60232543945312,10.6627502441406,0,0,7.14653778076172,0,0,0,0,10.8409957885742,0,7.19229125976562,0,0,0,0,13.8068389892578],"filename":[null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>",null,null,"<expr>","<expr>","<expr>","<expr>",null,"<expr>","<expr>",null,"<expr>","<expr>",null,null,null,"<expr>","<expr>",null,"<expr>","<expr>",null,null,null,null,"<expr>","<expr>",null,null,"<expr>","<expr>",null,"<expr>","<expr>",null,null,"<expr>","<expr>",null,null,null,"<expr>","<expr>",null,null,"<expr>","<expr>","<expr>","<expr>",null,"<expr>","<expr>",null,null,null,"<expr>","<expr>","<expr>","<expr>",null,null,"<expr>","<expr>","<expr>","<expr>",null,"<expr>","<expr>",null,"<expr>","<expr>",null,null,"<expr>","<expr>",null,"<expr>","<expr>","<expr>",null,"<expr>","<expr>",null,"<expr>","<expr>",null,null,null,"<expr>","<expr>",null,"<expr>","<expr>","<expr>","<expr>","<expr>",null,"<expr>","<expr>",null,null,"<expr>","<expr>",null,"<expr>","<expr>",null,null,"<expr>","<expr>","<expr>","<expr>",null,null,null,"<expr>","<expr>",null,null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,null,null,"<expr>","<expr>",null,null,"<expr>","<expr>",null,null,"<expr>","<expr>","<expr>",null,null,"<expr>","<expr>","<expr>","<expr>",null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,"<expr>","<expr>",null,"<expr>","<expr>",null,null,null,"<expr>","<expr>","<expr>",null,"<expr>","<expr>",null,null,null,"<expr>","<expr>","<expr>","<expr>",null,null,null,"<expr>","<expr>","<expr>"]},"interval":10,"files":[{"filename":"<expr>","content":"profvis({\n  data1 <- data\n  means <- vapply(data1[, names(data1) != \"id\"], mean, numeric(1))\n\n  for (i in seq_along(means)) {\n    data1[, names(data1) != \"id\"][, i] <- data1[, names(data1) != \"id\"][, i] - means[i]\n  }\n})","normpath":"<expr>"}],"prof_output":"/tmp/Rtmp6M6RD8/file2580334c3c8c.prof","highlight":{"output":["^output\\$"],"gc":["^<GC>$"],"stacktrace":["^\\.\\.stacktraceo(n|ff)\\.\\.$"]},"split":"h"}},"evals":[],"jsHooks":[]}</script>
<p>Our code is about 3x faster than the original version. Most of the time is now spent on line 6, and the majority of that is in the <code>[&lt;-</code> function. This is usually called with syntax <code>x[i, j] &lt;- y</code>, which is equivalent to <code>`[&lt;-`(x, i, j, y)</code>. In addition to being slow, the code is ugly: on each side of the assignment operator we’re indexing into <code>data1</code> twice with <code>[</code>.</p>
<p>In this case, it’s useful to take a step back and think about the broader problem. We want to normalize each column. Couldn’t we we apply a function over the columns that does both steps, taking the mean and subtracting it? Because a data frame is a list, and we want to assign a list of values into the data frame, we’ll need to use <code>lapply</code>.</p>
<pre class="r"><code>profvis({
  data1 &lt;- data

  # Given a column, normalize values and return them
  col_norm &lt;- function(col) {
    col - mean(col)
  }

  # Apply the normalizer function over all columns except id
  data1[, names(data1) != &quot;id&quot;] &lt;- lapply(data1[, names(data1) != &quot;id&quot;], col_norm)
})</code></pre>
<div id="htmlwidget-596" style="width:100%;height:450px;" class="profvis html-widget"></div>
<script type="application/json" data-for="htmlwidget-596">{"x":{"message":{"prof":{"time":[1,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7,8,8,8,9,9,9,10,10,10,11,11,11,11,12,12,12,13,13,13,13,14,14,14,14,15,15,15,15,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,22,22,22,22,23,23,23,23,24,24,24,24,25,25,25,25,26,26,26,27,27,27,28,28,28,28,29,29,29,30,30,30],"depth":[4,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,4,3,2,1,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,4,3,2,1,3,2,1,3,2,1,4,3,2,1,3,2,1,3,2,1],"label":["mean.default","mean","FUN","lapply","-","FUN","lapply","-","FUN","lapply","-","FUN","lapply","-","FUN","lapply","-","FUN","lapply","-","FUN","lapply","-","FUN","lapply","-","FUN","lapply","-","FUN","lapply","mean.default","mean","FUN","lapply","-","FUN","lapply","mean.default","mean","FUN","lapply","mean.default","mean","FUN","lapply","mean.default","mean","FUN","lapply","-","FUN","lapply","mean.default","mean","FUN","lapply","mean.default","mean","FUN","lapply","mean.default","mean","FUN","lapply","mean.default","mean","FUN","lapply","mean.default","mean","FUN","lapply","mean.default","mean","FUN","lapply","mean.default","mean","FUN","lapply","mean.default","mean","FUN","lapply","mean.default","mean","FUN","lapply","-","FUN","lapply","-","FUN","lapply","mean.default","mean","FUN","lapply","-","FUN","lapply","-","FUN","lapply"],"filenum":[null,1,null,1,1,null,1,1,null,1,1,null,1,1,null,1,1,null,1,1,null,1,1,null,1,1,null,1,1,null,1,null,1,null,1,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,1,null,1,1,null,1,null,1,null,1,1,null,1,1,null,1],"linenum":[null,6,null,10,6,null,10,6,null,10,6,null,10,6,null,10,6,null,10,6,null,10,6,null,10,6,null,10,6,null,10,null,6,null,10,6,null,10,null,6,null,10,null,6,null,10,null,6,null,10,6,null,10,null,6,null,10,null,6,null,10,null,6,null,10,null,6,null,10,null,6,null,10,null,6,null,10,null,6,null,10,null,6,null,10,null,6,null,10,6,null,10,6,null,10,null,6,null,10,6,null,10,6,null,10],"memalloc":[952.535583496094,952.535583496094,952.535583496094,952.535583496094,964.742774963379,964.742774963379,964.742774963379,983.053642272949,983.053642272949,983.053642272949,995.260887145996,995.260887145996,995.260887145996,1013.57175445557,1013.57175445557,1013.57175445557,1025.77899932861,1025.77899932861,1025.77899932861,1044.08986663818,1044.08986663818,1044.08986663818,1056.29711151123,1056.29711151123,1056.29711151123,1074.6079788208,1074.6079788208,1074.6079788208,1083.76346588135,1083.76346588135,1083.76346588135,1102.07433319092,1102.07433319092,1102.07433319092,1102.07433319092,1117.33333587646,1117.33333587646,1117.33333587646,1132.59244537354,1132.59244537354,1132.59244537354,1132.59244537354,1144.79969024658,1144.79969024658,1144.79969024658,1144.79969024658,1163.11055755615,1163.11055755615,1163.11055755615,1163.11055755615,1178.3695602417,1178.3695602417,1178.3695602417,1193.62866973877,1193.62866973877,1193.62866973877,1193.62866973877,1205.83591461182,1205.83591461182,1205.83591461182,1205.83591461182,1224.14678192139,1224.14678192139,1224.14678192139,1224.14678192139,1236.35402679443,1236.35402679443,1236.35402679443,1236.35402679443,1254.664894104,1254.664894104,1254.664894104,1254.664894104,1266.87213897705,1266.87213897705,1266.87213897705,1266.87213897705,1285.18300628662,1285.18300628662,1285.18300628662,1285.18300628662,1297.39025115967,1297.39025115967,1297.39025115967,1297.39025115967,1315.70111846924,1315.70111846924,1315.70111846924,1315.70111846924,1327.90830993652,1327.90830993652,1327.90830993652,1346.21917724609,1346.21917724609,1346.21917724609,1358.42646789551,1358.42646789551,1358.42646789551,1358.42646789551,1376.73728942871,1376.73728942871,1376.73728942871,1388.94453430176,1388.94453430176,1388.94453430176],"meminc":[0,0,0,0,12.2071914672852,0,0,18.3108673095703,0,0,12.2072448730469,0,0,18.3108673095703,0,0,12.2072448730469,0,0,18.3108673095703,0,0,12.2072448730469,0,0,18.3108673095703,0,0,9.15548706054688,0,0,18.3108673095703,0,0,0,15.2590026855469,0,0,15.2591094970703,0,0,0,12.2072448730469,0,0,0,18.3108673095703,0,0,0,15.2590026855469,0,0,15.2591094970703,0,0,0,12.2072448730469,0,0,0,18.3108673095703,0,0,0,12.2072448730469,0,0,0,18.3108673095703,0,0,0,12.2072448730469,0,0,0,18.3108673095703,0,0,0,12.2072448730469,0,0,0,18.3108673095703,0,0,0,12.2071914672852,0,0,18.3108673095703,0,0,12.2072906494141,0,0,0,18.3108215332031,0,0,12.2072448730469,0,0],"filename":[null,"<expr>",null,"<expr>","<expr>",null,"<expr>","<expr>",null,"<expr>","<expr>",null,"<expr>","<expr>",null,"<expr>","<expr>",null,"<expr>","<expr>",null,"<expr>","<expr>",null,"<expr>","<expr>",null,"<expr>","<expr>",null,"<expr>",null,"<expr>",null,"<expr>","<expr>",null,"<expr>",null,"<expr>",null,"<expr>",null,"<expr>",null,"<expr>",null,"<expr>",null,"<expr>","<expr>",null,"<expr>",null,"<expr>",null,"<expr>",null,"<expr>",null,"<expr>",null,"<expr>",null,"<expr>",null,"<expr>",null,"<expr>",null,"<expr>",null,"<expr>",null,"<expr>",null,"<expr>",null,"<expr>",null,"<expr>",null,"<expr>",null,"<expr>",null,"<expr>",null,"<expr>","<expr>",null,"<expr>","<expr>",null,"<expr>",null,"<expr>",null,"<expr>","<expr>",null,"<expr>","<expr>",null,"<expr>"]},"interval":10,"files":[{"filename":"<expr>","content":"profvis({\n  data1 <- data\n\n  # Given a column, normalize values and return them\n  col_norm <- function(col) {\n    col - mean(col)\n  }\n\n  # Apply the normalizer function over all columns except id\n  data1[, names(data1) != \"id\"] <- lapply(data1[, names(data1) != \"id\"], col_norm)\n})","normpath":"<expr>"}],"prof_output":"/tmp/Rtmp6M6RD8/file258057d884a.prof","highlight":{"output":["^output\\$"],"gc":["^<GC>$"],"stacktrace":["^\\.\\.stacktraceo(n|ff)\\.\\.$"]},"split":"h"}},"evals":[],"jsHooks":[]}</script>
<p>Now we have code that’s not only about 8x faster than our original – it’s shorter and more elegant as well. Not bad! The profiler data helped us to identify performance bottlenecks, and understanding of the underlying data structures allowed us to approach the problem in a more efficient way.</p>
<p>Could we further optimize the code? It seems unlikely, given that all the time is spent in functions that are implemented in C (<code>mean</code> and <code>-</code>). That doesn’t necessarily mean that there’s no room for improvement, but this is a good place to move on to the next example.</p>
</div>
<div id="example-2" class="section level3">
<h3>Example 2</h3>
<p>This example addresses some more advanced issues. This time, it will be hard to directly see the causes of slowness, but we will be able to see some of their side-effects, most notably the side-effects from large amounts of memory allocation.</p>
<p>Suppose you have a data frame that contains a column for which you’d like to take a cumulative sum (and you don’t know about R’s built-in <code>cumsum</code> function). Here’s one way to do it:</p>
<pre class="r"><code>profvis({
  data &lt;- data.frame(value = runif(3e4))

  data$sum[1] &lt;- data$value[1]
  for (i in seq(2, nrow(data))) {
    data$sum[i] &lt;- data$sum[i-1] + data$value[i]
  }
})</code></pre>
<div id="htmlwidget-2825" style="width:100%;height:450px;" class="profvis html-widget"></div>
<script type="application/json" data-for="htmlwidget-2825">{"x":{"message":{"prof":{"time":[1,2,2,2,2,3,3,3,3,3,3,4,4,4,4,4,4,4,5,5,5,6,7,8,9,9,10,11,11,12,12,12,12,13,13,13,13,14,14,14,14,14,15,16,16,16,16,16,16,17,17,17,17,18,19,19,20,20,21,22,22,22,22,22,22,23,24,25,26,27,27,27,27,28,29,29,29,29,30,31,32,32,32,33,33,33,33,33,34,34,34,34,34,35,35,36,36,36,36,36,37,38,39,40,41,42,43,43,44,44,44,44,44,45,45,45,46,46,46,46,46,47,48,48,49,50,51,52,52,52,52,52,52,53,53,53,53,53,54,55,56,57,58,58,59,59,59,59,60,61,62,62,63,64,65,65,65,65,65,66,66,67,68,69,69,69,69,70,71,72,72,72,72,73,73,74,75,75,75,76,77,78,79,80,81,82,83,83,83,83,83,83,84,85,85,85,85,85,86,86,87,88,89,90,90,90,91,92,93,93,93,93,93,94,95,96,97,98,99,99,99,99,99,99,99,100,101,101,101,101,101,102,103,103,103,103,103,103,104,105,105,105,105,106,107,107,108,108,108,109,109,109,109,110,110,111,111,111,111,112,113,113,114,115,115,116,117,117,117,117,118,119,120,120,121,122,123,123,123,123,124,125,126,126,126,126,127,128,129,129,129,129,129,129,130,131,131,131,131,131,131,131,132,133,134,134,135,136,136,137,137,138,138,138,138,139,140,140,140,140,140,140,141,142,143,144,145,145,145,145,145,146,147,147,147,147,148,149,149,149,149,149,150,151,152,152,153,153,153,153,153,154,155,156,157,158,158,159,160,160,160,160,161,162,162,163,164,165,165,165,166,166,166,166,166,166,166,167,167,167,167,168,169,170,171,171,171,171,171,172,173,173,173,173,173,174,174,174,174,174,174,175,176,177,178,179,179,179,179,180,181,181,181,181,182,183,184,184,184,184,184,185,186,187,188,189,190,191,191,191,191,191,191,192,192,192,192,193,193,194,194,194,194,195,196,196,197,198,198,198,198,199],"depth":[1,4,3,2,1,6,5,4,3,2,1,7,6,5,4,3,2,1,3,2,1,1,1,1,2,1,1,2,1,4,3,2,1,4,3,2,1,5,4,3,2,1,1,6,5,4,3,2,1,4,3,2,1,1,2,1,2,1,1,6,5,4,3,2,1,1,1,1,1,4,3,2,1,1,4,3,2,1,1,1,3,2,1,5,4,3,2,1,5,4,3,2,1,2,1,5,4,3,2,1,1,1,1,1,1,1,2,1,5,4,3,2,1,3,2,1,5,4,3,2,1,1,2,1,1,1,1,6,5,4,3,2,1,5,4,3,2,1,1,1,1,1,2,1,4,3,2,1,1,1,2,1,1,1,5,4,3,2,1,2,1,1,1,4,3,2,1,1,1,4,3,2,1,2,1,1,3,2,1,1,1,1,1,1,1,1,6,5,4,3,2,1,1,5,4,3,2,1,2,1,1,1,1,3,2,1,1,1,5,4,3,2,1,1,1,1,1,1,7,6,5,4,3,2,1,1,5,4,3,2,1,1,6,5,4,3,2,1,1,4,3,2,1,1,2,1,3,2,1,4,3,2,1,2,1,4,3,2,1,1,2,1,1,2,1,1,4,3,2,1,1,1,2,1,1,1,4,3,2,1,1,1,4,3,2,1,1,1,6,5,4,3,2,1,1,7,6,5,4,3,2,1,1,1,2,1,1,2,1,2,1,4,3,2,1,1,6,5,4,3,2,1,1,1,1,1,5,4,3,2,1,1,4,3,2,1,1,5,4,3,2,1,1,1,2,1,5,4,3,2,1,1,1,1,1,2,1,1,4,3,2,1,1,2,1,1,1,3,2,1,7,6,5,4,3,2,1,4,3,2,1,1,1,1,5,4,3,2,1,1,5,4,3,2,1,6,5,4,3,2,1,1,1,1,1,4,3,2,1,1,4,3,2,1,1,1,5,4,3,2,1,1,1,1,1,1,1,6,5,4,3,2,1,4,3,2,1,2,1,4,3,2,1,1,2,1,1,4,3,2,1,1],"label":["data$sum[i] <- data$sum[i-1] + data$value[i]","[[.data.frame","[[","$.data.frame","$","match","%in%","[[.data.frame","[[","$.data.frame","$","sys.call","match","%in%","[[.data.frame","[[","$.data.frame","$","[[","$.data.frame","$","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","$.data.frame","$","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","$","[[.data.frame","[[","$.data.frame","$","[[.data.frame","[[","$.data.frame","$","<Anonymous>","[[.data.frame","[[","$.data.frame","$","data$sum[i] <- data$sum[i-1] + data$value[i]","match","%in%","[[.data.frame","[[","$.data.frame","$","[[.data.frame","[[","$.data.frame","$","data$sum[i] <- data$sum[i-1] + data$value[i]","$<-.data.frame","$<-","data$sum[i] <- data$sum[i-1] + data$value[i]","$","data$sum[i] <- data$sum[i-1] + data$value[i]","match","%in%","[[.data.frame","[[","$.data.frame","$","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","[[.data.frame","[[","$.data.frame","$","data$sum[i] <- data$sum[i-1] + data$value[i]","[[.data.frame","[[","$.data.frame","$","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","$.data.frame","$","<Anonymous>","[[.data.frame","[[","$.data.frame","$","%in%","[[.data.frame","[[","$.data.frame","$","data$sum[i] <- data$sum[i-1] + data$value[i]","$","<Anonymous>","[[.data.frame","[[","$.data.frame","$","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","$<-.data.frame","$<-","<Anonymous>","[[.data.frame","[[","$.data.frame","$","[[","$.data.frame","$","%in%","[[.data.frame","[[","$.data.frame","$","data$sum[i] <- data$sum[i-1] + data$value[i]","$<-.data.frame","$<-","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","match","%in%","[[.data.frame","[[","$.data.frame","$","%in%","[[.data.frame","[[","$.data.frame","$","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","$<-.data.frame","$<-","[[.data.frame","[[","$.data.frame","$","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","$.data.frame","$","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","%in%","[[.data.frame","[[","$.data.frame","$","$<-.data.frame","$<-","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","[[.data.frame","[[","$.data.frame","$","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","[[.data.frame","[[","$.data.frame","$","data$sum[i] <- data$sum[i-1] + data$value[i]","$","data$sum[i] <- data$sum[i-1] + data$value[i]","[[","$.data.frame","$","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","match","%in%","[[.data.frame","[[","$.data.frame","$","data$sum[i] <- data$sum[i-1] + data$value[i]","<Anonymous>","[[.data.frame","[[","$.data.frame","$","$<-.data.frame","$<-","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","$<-.data.frame","$<-","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","<Anonymous>","[[.data.frame","[[","$.data.frame","$","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","names","match","%in%","[[.data.frame","[[","$.data.frame","$","data$sum[i] <- data$sum[i-1] + data$value[i]","%in%","[[.data.frame","[[","$.data.frame","$","data$sum[i] <- data$sum[i-1] + data$value[i]","match","%in%","[[.data.frame","[[","$.data.frame","$","data$sum[i] <- data$sum[i-1] + data$value[i]","[[.data.frame","[[","$.data.frame","$","data$sum[i] <- data$sum[i-1] + data$value[i]","$.data.frame","$",".row_names_info","$<-.data.frame","$<-","[[.data.frame","[[","$.data.frame","$","data$sum[i] <- data$sum[i-1] + data$value[i]","$","[[.data.frame","[[","$.data.frame","$","data$sum[i] <- data$sum[i-1] + data$value[i]","$<-.data.frame","$<-","data$sum[i] <- data$sum[i-1] + data$value[i]","$<-.data.frame","$<-","data$sum[i] <- data$sum[i-1] + data$value[i]","[[.data.frame","[[","$.data.frame","$","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","$.data.frame","$","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","[[.data.frame","[[","$.data.frame","$","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","[[.data.frame","[[","$.data.frame","$","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","match","%in%","[[.data.frame","[[","$.data.frame","$","data$sum[i] <- data$sum[i-1] + data$value[i]","sys.call","match","%in%","[[.data.frame","[[","$.data.frame","$","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","$<-","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","$","$<-.data.frame","$<-","[[.data.frame","[[","$.data.frame","$","data$sum[i] <- data$sum[i-1] + data$value[i]","match","%in%","[[.data.frame","[[","$.data.frame","$","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","<Anonymous>","[[.data.frame","[[","$.data.frame","$","data$sum[i] <- data$sum[i-1] + data$value[i]","[[.data.frame","[[","$.data.frame","$","data$sum[i] <- data$sum[i-1] + data$value[i]","%in%","[[.data.frame","[[","$.data.frame","$","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","$<-.data.frame","$<-","<Anonymous>","[[.data.frame","[[","$.data.frame","$","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","$.data.frame","$","data$sum[i] <- data$sum[i-1] + data$value[i]","[[.data.frame","[[","$.data.frame","$","data$sum[i] <- data$sum[i-1] + data$value[i]","$.data.frame","$","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","NROW","$<-.data.frame","$<-","sys.call","match","%in%","[[.data.frame","[[","$.data.frame","$","[[.data.frame","[[","$.data.frame","$","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","<GC>","[[.data.frame","[[","$.data.frame","$","data$sum[i] <- data$sum[i-1] + data$value[i]","<Anonymous>","[[.data.frame","[[","$.data.frame","$","match","%in%","[[.data.frame","[[","$.data.frame","$","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","[[.data.frame","[[","$.data.frame","$","data$sum[i] <- data$sum[i-1] + data$value[i]","<GC>",".row_names_info","$<-.data.frame","$<-","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","%in%","[[.data.frame","[[","$.data.frame","$","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]",".subset2","<Anonymous>","[[.data.frame","[[","$.data.frame","$","[[.data.frame","[[","$.data.frame","$","data$sum[i] <- data$sum[i-1] + data$value[i]","$","[[.data.frame","[[","$.data.frame","$","data$sum[i] <- data$sum[i-1] + data$value[i]","data$sum[i] <- data$sum[i-1] + data$value[i]","$<-","data$sum[i] <- data$sum[i-1] + data$value[i]","[[.data.frame","[[","$.data.frame","$","data$sum[i] <- data$sum[i-1] + data$value[i]"],"filenum":[1,null,null,1,1,null,null,null,null,1,1,null,null,null,null,null,1,1,null,1,1,1,1,1,1,1,1,1,1,null,null,1,1,null,null,1,1,null,null,null,1,1,1,null,null,null,null,1,1,null,null,1,1,1,1,1,1,1,1,null,null,null,null,1,1,1,1,1,1,null,null,1,1,1,null,null,1,1,1,1,1,1,1,null,null,null,1,1,null,null,null,1,1,1,1,null,null,null,1,1,1,1,1,1,1,1,1,1,null,null,null,1,1,null,1,1,null,null,null,1,1,1,1,1,1,1,1,null,null,null,null,1,1,null,null,null,1,1,1,1,1,1,1,1,null,null,1,1,1,1,1,1,1,1,null,null,null,1,1,1,1,1,1,null,null,1,1,1,1,null,null,1,1,1,1,1,null,1,1,1,1,1,1,1,1,1,null,null,null,null,1,1,1,null,null,null,1,1,1,1,1,1,1,1,1,1,1,1,null,null,null,1,1,1,1,1,1,1,null,null,null,null,null,1,1,1,null,null,null,1,1,1,null,null,null,null,1,1,1,null,null,1,1,1,1,1,null,1,1,null,null,1,1,1,1,null,null,1,1,1,1,1,1,1,1,1,null,null,1,1,1,1,1,1,1,1,null,null,1,1,1,1,null,null,1,1,1,1,null,null,null,null,1,1,1,null,null,null,null,null,1,1,1,1,1,1,1,1,1,1,1,null,null,1,1,1,null,null,null,null,1,1,1,1,1,1,null,null,null,1,1,1,null,null,1,1,1,null,null,null,1,1,1,1,1,1,null,null,null,1,1,1,1,1,1,1,1,1,null,null,1,1,1,1,1,1,1,null,1,1,null,null,null,null,null,1,1,null,null,1,1,1,1,1,null,null,null,1,1,1,null,null,null,1,1,null,null,null,null,1,1,1,1,1,1,null,null,1,1,1,null,null,1,1,1,1,null,null,null,1,1,1,1,1,1,1,1,null,null,null,null,1,1,null,null,1,1,1,1,null,null,1,1,1,1,1,1,null,null,1,1,1],"linenum":[6,null,null,6,6,null,null,null,null,6,6,null,null,null,null,null,6,6,null,6,6,6,6,6,6,6,6,6,6,null,null,6,6,null,null,6,6,null,null,null,6,6,6,null,null,null,null,6,6,null,null,6,6,6,6,6,6,6,6,null,null,null,null,6,6,6,6,6,6,null,null,6,6,6,null,null,6,6,6,6,6,6,6,null,null,null,6,6,null,null,null,6,6,6,6,null,null,null,6,6,6,6,6,6,6,6,6,6,null,null,null,6,6,null,6,6,null,null,null,6,6,6,6,6,6,6,6,null,null,null,null,6,6,null,null,null,6,6,6,6,6,6,6,6,null,null,6,6,6,6,6,6,6,6,null,null,null,6,6,6,6,6,6,null,null,6,6,6,6,null,null,6,6,6,6,6,null,6,6,6,6,6,6,6,6,6,null,null,null,null,6,6,6,null,null,null,6,6,6,6,6,6,6,6,6,6,6,6,null,null,null,6,6,6,6,6,6,6,null,null,null,null,null,6,6,6,null,null,null,6,6,6,null,null,null,null,6,6,6,null,null,6,6,6,6,6,null,6,6,null,null,6,6,6,6,null,null,6,6,6,6,6,6,6,6,6,null,null,6,6,6,6,6,6,6,6,null,null,6,6,6,6,null,null,6,6,6,6,null,null,null,null,6,6,6,null,null,null,null,null,6,6,6,6,6,6,6,6,6,6,6,null,null,6,6,6,null,null,null,null,6,6,6,6,6,6,null,null,null,6,6,6,null,null,6,6,6,null,null,null,6,6,6,6,6,6,null,null,null,6,6,6,6,6,6,6,6,6,null,null,6,6,6,6,6,6,6,null,6,6,null,null,null,null,null,6,6,null,null,6,6,6,6,6,null,null,null,6,6,6,null,null,null,6,6,null,null,null,null,6,6,6,6,6,6,null,null,6,6,6,null,null,6,6,6,6,null,null,null,6,6,6,6,6,6,6,6,null,null,null,null,6,6,null,null,6,6,6,6,null,null,6,6,6,6,6,6,null,null,6,6,6],"memalloc":[972.569709777832,1000.77492523193,1000.77492523193,1000.77492523193,1000.77492523193,1041.59191131592,1041.59191131592,1041.59191131592,1041.59191131592,1041.59191131592,1041.59191131592,1068.19198608398,1068.19198608398,1068.19198608398,1068.19198608398,1068.19198608398,1068.19198608398,1068.19198608398,1108.55025482178,1108.55025482178,1108.55025482178,1134.23261260986,1173.44480895996,1200.04431915283,1239.48561859131,1239.48561859131,1266.08533477783,936.564697265625,936.564697265625,966.833511352539,966.833511352539,966.833511352539,966.833511352539,1012.46617126465,1012.46617126465,1012.46617126465,1012.46617126465,1042.04704284668,1042.04704284668,1042.04704284668,1042.04704284668,1042.04704284668,1087.22062683105,1117.26050567627,1117.26050567627,1117.26050567627,1117.26050567627,1117.26050567627,1117.26050567627,1162.20507049561,1162.20507049561,1162.20507049561,1162.20507049561,1192.24418640137,1236.7301940918,1236.7301940918,1266.31126403809,1266.31126403809,937.252471923828,967.750434875488,967.750434875488,967.750434875488,967.750434875488,967.750434875488,967.750434875488,1012.69524383545,1041.81707000732,1086.3031539917,1116.11321258545,1160.59934234619,1160.59934234619,1160.59934234619,1160.59934234619,1190.63868713379,1235.58344268799,1235.58344268799,1235.58344268799,1235.58344268799,1265.39342498779,936.334579467773,966.145118713379,966.145118713379,966.145118713379,1011.31884765625,1011.31884765625,1011.31884765625,1011.31884765625,1011.31884765625,1040.6704864502,1040.6704864502,1040.6704864502,1040.6704864502,1040.6704864502,1085.61502075195,1085.61502075195,1115.42539978027,1115.42539978027,1115.42539978027,1115.42539978027,1115.42539978027,1160.3695526123,1190.4090423584,1235.12431335449,1265.16380310059,936.104637145996,966.373435974121,1011.54739379883,1011.54739379883,1041.12840270996,1041.12840270996,1041.12840270996,1041.12840270996,1041.12840270996,1085.84362030029,1085.84362030029,1085.84362030029,1115.65403747559,1115.65403747559,1115.65403747559,1115.65403747559,1115.65403747559,1160.59822845459,1190.40847015381,1190.40847015381,1235.12368011475,1264.93386077881,936.104125976562,966.602310180664,966.602310180664,966.602310180664,966.602310180664,966.602310180664,966.602310180664,1012.00547790527,1012.00547790527,1012.00547790527,1012.00547790527,1012.00547790527,1041.81549072266,1086.76007080078,1116.57027435303,1161.28552246094,1190.86650085449,1190.86650085449,1235.35266113281,1235.35266113281,1235.35266113281,1235.35266113281,1265.16253662109,936.333122253418,966.602233886719,966.602233886719,1012.46373748779,1042.04460906982,1086.76026916504,1086.76026916504,1086.76026916504,1086.76026916504,1086.76026916504,1116.57015228271,1116.57015228271,1161.74394989014,1191.78343963623,1236.49898529053,1236.49898529053,1236.49898529053,1236.49898529053,1266.53820037842,937.937698364258,967.977447509766,967.977447509766,967.977447509766,967.977447509766,1013.38072967529,1013.38072967529,1042.96159362793,1087.90619659424,1087.90619659424,1087.90619659424,1117.94544219971,1163.11921691895,1193.15870666504,1238.10359954834,1268.14277648926,939.771682739258,970.040817260742,1015.6732635498,1015.6732635498,1015.6732635498,1015.6732635498,1015.6732635498,1015.6732635498,1045.48316955566,1090.42795562744,1090.42795562744,1090.42795562744,1090.42795562744,1090.42795562744,1120.23803710938,1120.23803710938,1165.18251037598,1195.22200012207,1239.93728637695,1269.74749755859,1269.74749755859,1269.74749755859,941.605682373047,972.103790283203,1017.50741577148,1017.50741577148,1017.50741577148,1017.50741577148,1017.50741577148,1046.1706237793,1090.42739105225,1120.00814819336,1164.72341918945,1194.53371429443,1239.47834777832,1239.47834777832,1239.47834777832,1239.47834777832,1239.47834777832,1239.47834777832,1239.47834777832,1269.51766967773,940.688301086426,940.688301086426,940.688301086426,940.688301086426,940.688301086426,971.186134338379,1016.58950042725,1016.58950042725,1016.58950042725,1016.58950042725,1016.58950042725,1016.58950042725,1046.1702041626,1091.11515808105,1091.11515808105,1091.11515808105,1091.11515808105,1120.46634674072,1163.80596923828,1163.80596923828,1193.38669586182,1193.38669586182,1193.38669586182,1237.64367675781,1237.64367675781,1237.64367675781,1237.64367675781,1267.22438812256,1267.22438812256,938.16552734375,938.16552734375,938.16552734375,938.16552734375,968.20475769043,1012.92013549805,1012.92013549805,1042.50090026855,1087.44554138184,1087.44554138184,1117.48497009277,1162.42974853516,1162.42974853516,1162.42974853516,1162.42974853516,1192.46903991699,1237.41361999512,1267.22411346436,1267.22411346436,935.645484924316,965.914283752441,1010.40061950684,1010.40061950684,1010.40061950684,1010.40061950684,1039.52249908447,1084.4670791626,1114.04832458496,1114.04832458496,1114.04832458496,1114.04832458496,1159.22183990479,1189.26134490967,1234.20610809326,1234.20610809326,1234.20610809326,1234.20610809326,1234.20610809326,1234.20610809326,1264.24541473389,935.415809631348,935.415809631348,935.415809631348,935.415809631348,935.415809631348,935.415809631348,935.415809631348,965.913749694824,1011.54625701904,1041.12716674805,1041.12716674805,1086.30101776123,1116.11144256592,1116.11144256592,1161.05588531494,1161.05588531494,1190.63695526123,1190.63695526123,1190.63695526123,1190.63695526123,1235.58123016357,1265.39168548584,1265.39168548584,1265.39168548584,1265.39168548584,1265.39168548584,1265.39168548584,936.791038513184,967.28914642334,1012.92165374756,1042.73183441162,1087.67672729492,1087.67672729492,1087.67672729492,1087.67672729492,1087.67672729492,1117.71622467041,1162.66068267822,1162.66068267822,1162.66068267822,1162.66068267822,1192.69997406006,1237.41541290283,1237.41541290283,1237.41541290283,1237.41541290283,1237.41541290283,1267.45473480225,938.625038146973,969.12321472168,969.12321472168,1014.52654266357,1014.52654266357,1014.52654266357,1014.52654266357,1014.52654266357,1044.33652496338,1089.2811050415,1119.09128570557,1164.26517486572,1194.30480194092,1194.30480194092,1238.10269927979,1267.91319274902,1267.91319274902,1267.91319274902,1267.91319274902,939.08325958252,969.581611633301,969.581611633301,1014.98456573486,1044.33647155762,1089.28077697754,1089.28077697754,1089.28077697754,1119.09127807617,1119.09127807617,1119.09127807617,1119.09127807617,1119.09127807617,1119.09127807617,1119.09127807617,1159.44970703125,1159.44970703125,1159.44970703125,1159.44970703125,1188.11292266846,1228.47132110596,1258.51081085205,1277.77292633057,1277.77292633057,1277.77292633057,1277.77292633057,1277.77292633057,960.179336547852,1005.81214904785,1005.81214904785,1005.81214904785,1005.81214904785,1005.81214904785,1035.62222290039,1035.62222290039,1035.62222290039,1035.62222290039,1035.62222290039,1035.62222290039,1080.79591369629,1110.83540344238,1155.7799987793,1186.04878234863,1230.76442718506,1230.76442718506,1230.76442718506,1230.76442718506,1260.80354309082,1278.00178527832,1278.00178527832,1278.00178527832,1278.00178527832,962.701057434082,1008.33368682861,1037.91482543945,1037.91482543945,1037.91482543945,1037.91482543945,1037.91482543945,1083.31763458252,1113.35712432861,1158.30170440674,1188.34119415283,1233.28577423096,1263.32526397705,934.725128173828,934.725128173828,934.725128173828,934.725128173828,934.725128173828,934.725128173828,964.993804931641,964.993804931641,964.993804931641,964.993804931641,1010.62635040283,1010.62635040283,1040.20725250244,1040.20725250244,1040.20725250244,1040.20725250244,1085.38076782227,1115.1909866333,1115.1909866333,1160.36483764648,1190.40449523926,1190.40449523926,1190.40449523926,1190.40449523926,1235.57821655273],"meminc":[0,28.2052154541016,0,0,0,40.8169860839844,0,0,0,0,0,26.6000747680664,0,0,0,0,0,0,40.358268737793,0,0,25.6823577880859,39.2121963500977,26.5995101928711,39.4412994384766,0,26.5997161865234,-329.520637512207,0,30.2688140869141,0,0,0,45.6326599121094,0,0,0,29.5808715820312,0,0,0,0,45.173583984375,30.0398788452148,0,0,0,0,0,44.9445648193359,0,0,0,30.0391159057617,44.4860076904297,0,29.5810699462891,0,-329.058792114258,30.4979629516602,0,0,0,0,0,44.9448089599609,29.121826171875,44.486083984375,29.81005859375,44.4861297607422,0,0,0,30.0393447875977,44.9447555541992,0,0,0,29.8099822998047,-329.05884552002,29.8105392456055,0,0,45.1737289428711,0,0,0,0,29.3516387939453,0,0,0,0,44.9445343017578,0,29.8103790283203,0,0,0,0,44.9441528320312,30.0394897460938,44.7152709960938,30.0394897460938,-329.05916595459,30.268798828125,45.173957824707,0,29.5810089111328,0,0,0,0,44.715217590332,0,0,29.810417175293,0,0,0,0,44.9441909790039,29.8102416992188,0,44.7152099609375,29.8101806640625,-328.829734802246,30.4981842041016,0,0,0,0,0,45.4031677246094,0,0,0,0,29.8100128173828,44.944580078125,29.8102035522461,44.7152481079102,29.5809783935547,0,44.4861602783203,0,0,0,29.8098754882812,-328.829414367676,30.2691116333008,0,45.8615036010742,29.5808715820312,44.7156600952148,0,0,0,0,29.8098831176758,0,45.1737976074219,30.0394897460938,44.7155456542969,0,0,0,30.0392150878906,-328.60050201416,30.0397491455078,0,0,0,45.4032821655273,0,29.5808639526367,44.9446029663086,0,0,30.0392456054688,45.1737747192383,30.0394897460938,44.9448928833008,30.039176940918,-328.37109375,30.2691345214844,45.6324462890625,0,0,0,0,0,29.8099060058594,44.9447860717773,0,0,0,0,29.8100814819336,0,44.9444732666016,30.0394897460938,44.7152862548828,29.8102111816406,0,0,-328.141815185547,30.4981079101562,45.4036254882812,0,0,0,0,28.6632080078125,44.2567672729492,29.5807571411133,44.7152709960938,29.8102951049805,44.9446334838867,0,0,0,0,0,0,30.0393218994141,-328.829368591309,0,0,0,0,30.4978332519531,45.4033660888672,0,0,0,0,0,29.5807037353516,44.944953918457,0,0,0,29.351188659668,43.3396224975586,0,29.5807266235352,0,0,44.2569808959961,0,0,0,29.5807113647461,0,-329.058860778809,0,0,0,30.0392303466797,44.7153778076172,0,29.5807647705078,44.9446411132812,0,30.0394287109375,44.9447784423828,0,0,0,30.0392913818359,44.944580078125,29.8104934692383,0,-331.578628540039,30.268798828125,44.4863357543945,0,0,0,29.1218795776367,44.944580078125,29.5812454223633,0,0,0,45.1735153198242,30.0395050048828,44.9447631835938,0,0,0,0,0,30.039306640625,-328.829605102539,0,0,0,0,0,0,30.4979400634766,45.6325073242188,29.5809097290039,0,45.1738510131836,29.8104248046875,0,44.9444427490234,0,29.5810699462891,0,0,0,44.9442749023438,29.8104553222656,0,0,0,0,0,-328.600646972656,30.4981079101562,45.6325073242188,29.8101806640625,44.9448928833008,0,0,0,0,30.0394973754883,44.9444580078125,0,0,0,30.0392913818359,44.7154388427734,0,0,0,0,30.0393218994141,-328.829696655273,30.498176574707,0,45.4033279418945,0,0,0,0,29.8099822998047,44.944580078125,29.8101806640625,45.1738891601562,30.0396270751953,0,43.7978973388672,29.8104934692383,0,0,0,-328.829933166504,30.4983520507812,0,45.4029541015625,29.3519058227539,44.9443054199219,0,0,29.8105010986328,0,0,0,0,0,0,40.3584289550781,0,0,0,28.663215637207,40.3583984375,30.0394897460938,19.2621154785156,0,0,0,0,-317.593589782715,45.6328125,0,0,0,0,29.8100738525391,0,0,0,0,0,45.1736907958984,30.0394897460938,44.9445953369141,30.2687835693359,44.7156448364258,0,0,0,30.0391159057617,17.1982421875,0,0,0,-315.300727844238,45.6326293945312,29.5811386108398,0,0,0,0,45.4028091430664,30.0394897460938,44.944580078125,30.0394897460938,44.944580078125,30.0394897460938,-328.600135803223,0,0,0,0,0,30.2686767578125,0,0,0,45.6325454711914,0,29.5809020996094,0,0,0,45.1735153198242,29.8102188110352,0,45.1738510131836,30.0396575927734,0,0,0,45.1737213134766],"filename":["<expr>",null,null,"<expr>","<expr>",null,null,null,null,"<expr>","<expr>",null,null,null,null,null,"<expr>","<expr>",null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,null,"<expr>","<expr>",null,null,"<expr>","<expr>",null,null,null,"<expr>","<expr>","<expr>",null,null,null,null,"<expr>","<expr>",null,null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,null,null,null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,null,"<expr>","<expr>","<expr>",null,null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,null,null,"<expr>","<expr>",null,null,null,"<expr>","<expr>","<expr>","<expr>",null,null,null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,null,null,"<expr>","<expr>",null,"<expr>","<expr>",null,null,null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,null,null,null,"<expr>","<expr>",null,null,null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,null,null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,null,"<expr>","<expr>","<expr>","<expr>",null,null,"<expr>","<expr>","<expr>","<expr>","<expr>",null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,null,null,null,"<expr>","<expr>","<expr>",null,null,null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,null,null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,null,null,null,null,"<expr>","<expr>","<expr>",null,null,null,"<expr>","<expr>","<expr>",null,null,null,null,"<expr>","<expr>","<expr>",null,null,"<expr>","<expr>","<expr>","<expr>","<expr>",null,"<expr>","<expr>",null,null,"<expr>","<expr>","<expr>","<expr>",null,null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,null,"<expr>","<expr>","<expr>","<expr>",null,null,"<expr>","<expr>","<expr>","<expr>",null,null,null,null,"<expr>","<expr>","<expr>",null,null,null,null,null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,null,"<expr>","<expr>","<expr>",null,null,null,null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,null,null,"<expr>","<expr>","<expr>",null,null,"<expr>","<expr>","<expr>",null,null,null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,null,null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,"<expr>","<expr>",null,null,null,null,null,"<expr>","<expr>",null,null,"<expr>","<expr>","<expr>","<expr>","<expr>",null,null,null,"<expr>","<expr>","<expr>",null,null,null,"<expr>","<expr>",null,null,null,null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,null,"<expr>","<expr>","<expr>",null,null,"<expr>","<expr>","<expr>","<expr>",null,null,null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,null,null,null,"<expr>","<expr>",null,null,"<expr>","<expr>","<expr>","<expr>",null,null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,null,"<expr>","<expr>","<expr>"]},"interval":10,"files":[{"filename":"<expr>","content":"profvis({\n  data <- data.frame(value = runif(3e4))\n\n  data$sum[1] <- data$value[1]\n  for (i in seq(2, nrow(data))) {\n    data$sum[i] <- data$sum[i-1] + data$value[i]\n  }\n})","normpath":"<expr>"}],"prof_output":"/tmp/Rtmp6M6RD8/file25801cf7fce1.prof","highlight":{"output":["^output\\$"],"gc":["^<GC>$"],"stacktrace":["^\\.\\.stacktraceo(n|ff)\\.\\.$"]},"split":"h"}},"evals":[],"jsHooks":[]}</script>
<p>This takes over 2 seconds to calculate the cumulative sum of 30,000 items. That’s pretty slow for a computer program. Looking at the profvis visualization, we can see a number of notable features:</p>
<p>Almost all the time is spent in one line of code, line 6. Although this is just one line of code, many different functions that are called on that line.</p>
<p>That line also results in a large amount of memory being allocated and deallocated, which is somewhat suprising: just looking at the code, that line <em>appears</em> to just modify the data in-place, but that’s not actually what’s happening internally.</p>
<p>In the flame graph, you’ll see that some of the flame graph blocks have the label <code>$</code>, which means that those samples were spent in the <code>$</code> function for indexing into an object (in R, the expression <code>x$y</code> is equivalent to <code>`$`(x, &quot;y&quot;)</code>).</p>
<p>Because <code>$</code> is a <em>generic</em> function, it calls the corresponding <em>method</em> for the object, in this case <code>$.data.frame</code>. This function in turn calls <code>[[</code>, which calls <code>[[.data.frame</code>. (Zoom in to see this more clearly.)</p>
<p>Other flame graph cells have the label <code>$&lt;-</code>. The usual syntax for calling this function is <code>x$y &lt;- z</code>; this is equivalent to <code>`$&lt;-`(x, &quot;y&quot;, z)</code>. (Assignment with indexing, as in <code>x$y[i] &lt;- z</code> is actually a bit <a href="http://adv-r.had.co.nz/Functions.html#replacement-functions">more complicated</a>, and it turns out that this is the cause of the excessive memory allocation and deallocation.)</p>
<p>Finally, many of the flame graph cells contain the entire expression from line 6. This can mean one of two things:</p>
<ol style="list-style-type: decimal">
<li>R is currently evaluating the expression but is not inside another function call.</li>
<li>R is in another function, but that function does not show up on the stack. (A number of R’s internal functions do not show up in the profiling data. See <a href="#why-do-some-function-calls-not-show-in-the-profiler">more</a> about this in the FAQ.)</li>
</ol>
<p>This profiling data tells us that much of the time is spent in <code>$</code> and <code>$&lt;-</code>. Maybe avoiding these functions entirely will speed things up. To do that, instead of operating on data frame columns, we can operate on temporary vectors. As it turns out, writing a function that takes a vector as input and returns a vector as output is not only convenient; it provides a natural way of creating temporary variables so that we can avoid calling <code>$</code> and <code>$&lt;-</code> in a loop.</p>
<pre class="r"><code>profvis({
  csum &lt;- function(x) {
    if (length(x) &lt; 2) return(x)

    sum &lt;- x[1]
    for (i in seq(2, length(x))) {
      sum[i] &lt;- sum[i-1] + x[i]
    }
    sum
  }
  data$sum &lt;- csum(data$value)
})</code></pre>
<div id="htmlwidget-2658" style="width:100%;height:450px;" class="profvis html-widget"></div>
<script type="application/json" data-for="htmlwidget-2658">{"x":{"message":{"prof":{"time":[1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,13,14,14,15,15,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,28,29,29,30,30,31,31,32,32,33,33,34,34,35,35,36,36,37,37,38,38,39,39,40,40,41,41,42,42,43,43,44,44,45,45,46,46,47,47,48,48,49,49,50,50,51,51,52,52,53,53,54,54,55,55,56,56,57,57,58,58,59,59,60,60,61,61],"depth":[2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,3,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,3,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1],"label":["sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","<GC>","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","+","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","<GC>","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum","sum[i] <- sum[i-1] + x[i]","csum"],"filenum":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,null,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,null,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],"linenum":[7,11,7,11,7,11,7,11,7,11,7,11,7,11,7,11,7,11,7,11,7,11,7,11,null,7,11,7,11,7,11,7,11,7,11,7,11,7,11,7,11,7,11,7,11,7,11,7,11,7,11,7,11,7,11,null,7,11,7,11,7,11,7,11,7,11,7,11,7,11,7,11,7,11,7,11,7,11,7,11,7,11,7,11,7,11,7,11,7,11,7,11,7,11,7,11,7,11,7,11,7,11,7,11,7,11,7,11,7,11,7,11,7,11,7,11,7,11,7,11,7,11,7,11],"memalloc":[542.033950805664,542.033950805664,587.51301574707,587.51301574707,658.040679931641,658.040679931641,706.016708374023,706.016708374023,781.467239379883,781.467239379883,832.315879821777,832.315879821777,909.663101196289,909.663101196289,961.420265197754,961.420265197754,1036.18202972412,1036.18202972412,1088.46898651123,1088.46898651123,1165.59677886963,1165.59677886963,1218.23310089111,1218.23310089111,1281.76728057861,1281.76728057861,1281.76728057861,493.562492370605,493.562492370605,573.368377685547,573.368377685547,626.595252990723,626.595252990723,674.134666442871,674.134666442871,712.816246032715,712.816246032715,785.29776763916,785.29776763916,834.833518981934,834.833518981934,914.251625061035,914.251625061035,966.393112182617,966.393112182617,1046.02587890625,1046.02587890625,1098.90120697021,1098.90120697021,1178.78695678711,1178.78695678711,1231.49633789062,1231.49633789062,1276.47619628906,1276.47619628906,765.901649475098,765.901649475098,765.901649475098,549.080612182617,549.080612182617,601.839973449707,601.839973449707,680.498100280762,680.498100280762,732.210151672363,732.210151672363,805.960823059082,805.960823059082,857.839622497559,857.839622497559,937.203826904297,937.203826904297,989.168281555176,989.168281555176,1069.41983795166,1069.41983795166,1122.62992095947,1122.62992095947,1203.06414794922,1203.06414794922,1257.27572631836,1257.27572631836,481.405960083008,481.405960083008,514.250434875488,514.250434875488,563.930610656738,563.930610656738,597.129249572754,597.129249572754,658.792060852051,658.792060852051,708.29118347168,708.29118347168,784.331451416016,784.331451416016,836.857818603516,836.857818603516,917.003059387207,917.003059387207,969.939170837402,969.939170837402,1050.25177001953,1050.25177001953,1103.32006072998,1103.32006072998,1167.09310913086,1167.09310913086,1188.71612548828,1188.71612548828,1221.40084838867,1221.40084838867,1243.43183898926,1243.43183898926,1276.17776489258,1276.17776489258,474.70093536377,474.70093536377,545.013061523438,545.013061523438,595.021156311035,595.021156311035,669.823783874512,669.823783874512],"meminc":[0,0,45.4790649414062,0,70.5276641845703,0,47.9760284423828,0,75.4505310058594,0,50.8486404418945,0,77.3472213745117,0,51.7571640014648,0,74.7617645263672,0,52.2869567871094,0,77.1277923583984,0,52.6363220214844,0,63.5341796875,0,0,-788.204788208008,0,79.8058853149414,0,53.2268753051758,0,47.5394134521484,0,38.6815795898438,0,72.4815216064453,0,49.5357513427734,0,79.4181060791016,0,52.141487121582,0,79.6327667236328,0,52.8753280639648,0,79.8857498168945,0,52.7093811035156,0,44.9798583984375,0,-510.574546813965,0,0,-216.82103729248,0,52.7593612670898,0,78.6581268310547,0,51.7120513916016,0,73.7506713867188,0,51.8787994384766,0,79.3642044067383,0,51.9644546508789,0,80.2515563964844,0,53.2100830078125,0,80.4342269897461,0,54.2115783691406,0,-775.869766235352,0,32.8444747924805,0,49.68017578125,0,33.1986389160156,0,61.6628112792969,0,49.4991226196289,0,76.0402679443359,0,52.5263671875,0,80.1452407836914,0,52.9361114501953,0,80.3125991821289,0,53.0682907104492,0,63.7730484008789,0,21.6230163574219,0,32.6847229003906,0,22.0309906005859,0,32.7459259033203,0,-801.476829528809,0,70.312126159668,0,50.0080947875977,0,74.8026275634766,0],"filename":["<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>"]},"interval":10,"files":[{"filename":"<expr>","content":"profvis({\n  csum <- function(x) {\n    if (length(x) < 2) return(x)\n\n    sum <- x[1]\n    for (i in seq(2, length(x))) {\n      sum[i] <- sum[i-1] + x[i]\n    }\n    sum\n  }\n  data$sum <- csum(data$value)\n})","normpath":"<expr>"}],"prof_output":"/tmp/Rtmp6M6RD8/file258068aa7b26.prof","highlight":{"output":["^output\\$"],"gc":["^<GC>$"],"stacktrace":["^\\.\\.stacktraceo(n|ff)\\.\\.$"]},"split":"h"}},"evals":[],"jsHooks":[]}</script>
<p>Using this <code>csum</code> function, it takes just over half a second, which is about 4x as fast as before.</p>
<p>It may appear that no functions are called from line 7, but that’s not quite true: that line also calls <code>[</code>, <code>[&lt;-</code>, <code>-</code>, and <code>+</code>.</p>
<ul>
<li>The <code>[</code> and <code>[&lt;-</code> functions don’t appear in the flame graph. They are internal R functions which contain C code to handle indexing into atomic vectors, and are not dispatched to methods. (Contrast this with the first version of the code, where <code>$</code> was dispatched to <code>$.data.frame</code>).</li>
<li>The <code>-</code> and <code>+</code> functions can show up in a flame graph, but they are very fast so the sampling profiler may or may not happen to take a sample when they’re on the call stack.</li>
</ul>
<p>The code panel shows that there is still a large amount of memory being allocated in the <code>csum</code> function. In the flame graph. you probably have noticed the gray blocks labeled <code>&lt;GC&gt;</code>. These represent times where R is doing <em>garbage collection</em> – that is, when it is freeing (deallocating) chunks of memory that were allocated but no longer needed. If R is spending a lot of time freeing memory, that suggests that R is also spending a lot of time allocating memory. This is another common source of slowness in R code.</p>
<p>In the <code>csum</code> function, <code>sum</code> starts as a length-1 vector, and then grows, in a loop, to be the same length as <code>x</code>. Every time a vector grows, R allocates a new block of memory for the new, larger vector, and then copies the contents over. The memory allocated for the old vector is no longer needed, and will later be garbage collected.</p>
<p>To avoid all that memory allocation, copying, and garbage collection, we can pre-allocate a correctly-sized vector for <code>sum</code>. For this data, that will result in 29,999 fewer allocations, copies, and deallocations.</p>
<pre class="r"><code>profvis({
  csum2 &lt;- function(x) {
    if (length(x) &lt; 2) return(x)

    sum &lt;- numeric(length(x))  # Preallocate
    sum[1] &lt;- x[1]
    for (i in seq(2, length(x))) {
      sum[i] &lt;- sum[i-1] + x[i]
    }
    sum
  }
  data$sum &lt;- csum2(data$value)
})</code></pre>
<div id="htmlwidget-911" style="width:100%;height:450px;" class="profvis html-widget"></div>
<script type="application/json" data-for="htmlwidget-911">{"x":{"message":{"prof":{"time":[1,1,2,2,3,3,4,4,4],"depth":[2,1,2,1,2,1,3,2,1],"label":["sum[i] <- sum[i-1] + x[i]","csum2","sum[i] <- sum[i-1] + x[i]","csum2","sum[i] <- sum[i-1] + x[i]","csum2","<GC>","sum[i] <- sum[i-1] + x[i]","csum2"],"filenum":[1,1,1,1,1,1,null,1,1],"linenum":[8,12,8,12,8,12,null,8,12],"memalloc":[474.474273681641,474.474273681641,474.615943908691,474.615943908691,474.809150695801,474.809150695801,474.887100219727,474.887100219727,474.887100219727],"meminc":[0,0,0.141670227050781,0,0.193206787109375,0,0.0779495239257812,0,0],"filename":["<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,"<expr>","<expr>"]},"interval":10,"files":[{"filename":"<expr>","content":"profvis({\n  csum2 <- function(x) {\n    if (length(x) < 2) return(x)\n\n    sum <- numeric(length(x))  # Preallocate\n    sum[1] <- x[1]\n    for (i in seq(2, length(x))) {\n      sum[i] <- sum[i-1] + x[i]\n    }\n    sum\n  }\n  data$sum <- csum2(data$value)\n})","normpath":"<expr>"}],"prof_output":"/tmp/Rtmp6M6RD8/file25801a77458b.prof","highlight":{"output":["^output\\$"],"gc":["^<GC>$"],"stacktrace":["^\\.\\.stacktraceo(n|ff)\\.\\.$"]},"split":"h"}},"evals":[],"jsHooks":[]}</script>
<p>This version of the code, with <code>csum2</code>, is around 60x faster than our original code, and requires almost no memory allocation. These performance improvements were possible by avoiding calls to <code>$</code> and <code>$&lt;-</code>, and by avoiding unnecessary memory allocation and copying from growing a vector in a loop.</p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
